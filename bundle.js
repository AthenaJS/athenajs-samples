!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=15)}([/*!**********************************!*\
  !*** ../athenajs/dist/athena.js ***!
  \**********************************/
function(t,e,i){!function(e,i){t.exports=i()}(0,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=45)}([/*!*****************************!*\
  !*** ./js/Util/Deferred.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! es6-promise */19),s=i.n(r),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function t(){var e=this;n(this,t),this.promise=new s.a(function(t,i){e.resolve=t,e.reject=i})}return o(t,null,[{key:"resolve",value:function(t){return s.a.resolve(t)}}]),t}();e.a=a},/*!******************************************!*\
  !*** ./js/Drawable/Behavior/Behavior.js ***!
  \******************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e,i){n(this,t),this.sprite=e,e.gravity=void 0!==i.gravity?i.gravity:0,e.vx=void 0!==i.vx?i.vx:0,e.vy=void 0!==i.vy?i.vy:0,this.checkWalls=i.checkWalls||!1,this.checkFall=i.checkFall||!1,this.onVXChange=i.onVXChange||null,this.onVYChange=i.onVYChange||null}return r(t,[{key:"onUpdate",value:function(){}},{key:"getMapEvent",value:function(){return this.sprite.currentMap.mapEvent}}]),t}();e.a=s},/*!*********************************!*\
  !*** ./js/Drawable/Drawable.js ***!
  \*********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../FX/FX */3),s=i(/*! ./Behavior/Behaviors */21),o=i(/*! ../Notification/NotificationManager */9),a=i(/*! ../Audio/AudioManager */7),u=i(/*! ../Util/Deferred */0),l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function(){function t(e,i){if(n(this,t),this.type=e,this.id=i.objectId||this.type+(new Date).getTime(),this.layer=i.layer||0,this.currentMap=null,this.currentScene=null,this._destroyed=!1,this.children=[],this.wave=i.wave||null,this.behavior=null,this.platform=null,this.mask=null,this.collideGroup=i.collideGroup||0,this.canCollideFriendBullet=i.canCollideFriendBullet||!1,this.master=i.master||!1,this.moving=!1,this.easing=r.a.getEasing(i.easing||"linear"),i.behavior&&this.setBehavior(i.behavior,i.behaviorOptions),this._settings=Object.assign({speed:1,visible:!0,canCollide:!1,plane:0,x:0,y:0,vx:0,vy:0,scale:1,angle:0,movable:!0,gravity:0,data:{},path:null,target:null,targetOffsetX:0,targetOffsetY:0,wave:i.wave||null},i),this.target=null,this.spline=null,this.currentMovement="",this.fxQueue={},i.pool||(this._reset(),this.reset(),i.animate&&this.animate(i.animate.name,i.animate.options)),i.scene)return void i.scene.addObject(this);i.map}return l(t,[{key:"reset",value:function(){}},{key:"_reset",value:function(){this.speed=this._settings.speed,this.visible=this._settings.visible,this.canCollide=this._settings.canCollide,this.plane=this._settings.plane,this.x=this._settings.x,this.y=this._settings.y,this.opacity=this._settings.opacity||1,this.scale=this._settings.scale,this.angle=this._settings.angle,this.movable=this._settings.movable,this.moving=!1,this.data=this._settings.data,this.path=null,this.vx=this._settings.vx||0,this.vy=this._settings.vy||0,this.gravity=this._settings.gravity,this.moveHandlers=[],this.targetOffsetX=this._settings.targetOffsetX||0,this.targetOffsetY=this._settings.targetOffsetY||0,this.target=this._settings.target||null,this.savedX=this.x,this.savedY=this.y,this.wave=this._settings.wave}},{key:"setMap",value:function(t){this.currentMap=t,this.children.forEach(function(e){e.setMap(t)})}},{key:"setScene",value:function(t){this.currentScene=t,this.children.forEach(function(e){e.setScene(t)})}},{key:"setPlatform",value:function(t){this.platform=t}},{key:"moveTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.moving||(0===i?(this.x=t,this.y=e,this._onUpdate()):(console.log("moveTo from",this.x,"to",t),this.targetX=t,this.targetY=e,this.duration=i,this.startMoveTime=(new Date).getTime(),this.targetDistanceX=t-this.x|0,this.targetDistanceY=e-this.y|0,this.targetStartX=this.x,this.targetStartY=this.y,this.moving=!0)),this}},{key:"snapToMap",value:function(t,e){if(this.currentMap){var i=this.currentMap,n=i.getTileIndexFromPixel(this.x,this.y);this.x%i.tileWidth&&!t&&n.x++,this.y%i.tileHeight&&!e&&n.y++,n=i.getTilePixelPos(n.x,n.y),this.moveTo(n.x,n.y)}}},{key:"setMask",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.mask=t,e&&t&&(t.exclude=!0)}},{key:"setOpacity",value:function(t){this.opacity=t}},{key:"getOpacity",value:function(){return this.opacity}},{key:"cancelMoveTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.moving&&(this.moving=!1,t&&(this.x=this.targetX,this.y=this.targetY))}},{key:"center",value:function(){var t=this.currentScene.display;return this.x=(t.width-this.width)/2,this.y=(t.height-this.height)/2,this}},{key:"setBehavior",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.behavior="string"==typeof t?new(s.a.getBehavior(t))(this,e):new t(this,e)}},{key:"clearBehavior",value:function(){this.vx=this.vy=0,this.behavior=null}},{key:"_applyMask",value:function(t,e,i){if(this.mask){var n=this.mask;n.exclude?(t.save(),t.fillStyle=n.color||"black",t.fillRect(e+n.x,i+n.y,n.width,n.height)):(t.save(),t.beginPath(),t.rect(e+n.x,i+n.y,n.width,n.height),t.clip())}}},{key:"_undoMask",value:function(t){this.mask&&t.restore()}},{key:"update",value:function(t){if(this.movable){if(!0===this.moving){var e=t-this.startMoveTime,i=e/this.duration,n=0;e>=this.duration?(this.moving=!1,this.x=this.targetX,this.y=this.targetY):(n=this.easing(i,e,0,1,this.duration),this.x=this.targetStartX+n*this.targetDistanceX|0,this.y=this.targetStartY+n*this.targetDistanceY|0)}else this.behavior?this.behavior.onUpdate(t):(this.x+=this.vx,this.y+=this.vy,this.vy-=this.gravity);this.children.length&&this.children.forEach(function(t){t.update()})}}},{key:"savePosition",value:function(){this.savedX=this.x,this.savedY=this.y}},{key:"getSavedPosition",value:function(){return{x:this.savedX,y:this.savedY}}},{key:"moveWithSpline",value:function(){}},{key:"setPath",value:function(t){this.path=t}},{key:"setScale",value:function(t){this.scale=t}},{key:"setAngle",value:function(t){this.angle=t}},{key:"getAngle",value:function(){return this.angle}},{key:"transform",value:function(t,e){switch(t){case"scale":this.scale=e}}},{key:"hide",value:function(){return this.visible=!1,this}},{key:"show",value:function(){return this.visible=!0,this}},{key:"applyCtxAlpha",value:function(t){this._oldAlpha=t.globalAlpha,t.globalAlpha=this.opacity}},{key:"restoreCtxAlpha",value:function(t){t.globalAlpha=this._oldAlpha}},{key:"getCurrentWidth",value:function(){return this.width}},{key:"getCurrentHeight",value:function(){return this.height}},{key:"getHitBox",value:function(){return{x:0,y:0,x2:this.getCurrentWidth()-1,y2:this.getCurrentHeight()-1}}},{key:"showHitBox",value:function(t){if(this.visible){var e=this.getHitBox(),i=this.currentMap&&this.currentMap.viewportX||0,n=this.currentMap&&this.currentMap.viewportY||0;e&&(t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0,230,0)",t.beginPath(),t.moveTo(e.x+this.x+i,e.y+this.y+n),t.lineTo(e.x2+this.x+i,e.y+this.y+n),t.lineTo(e.x2+this.x+i,e.y2+this.y+n),t.lineTo(e.x+this.x+i,e.y2+this.y+n),t.lineTo(e.x+this.x+i,e.y+this.y+n),t.closePath(),t.stroke())}}},{key:"showObjectBox",value:function(t){t.strokeStyle="rgb(0,230,0)",t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.width+this.x,this.y),t.lineTo(this.width+this.x,this.y+this.height),t.lineTo(this.x,this.y+this.height),t.lineTo(this.x,this.y),t.closePath(),t.stroke()}},{key:"hitTest",value:function(t){var e=t.getHitBox(),i=!1;if(this.canCollide&&t.canCollide&&this!==t&&this.visible){var n=this.getHitBox(),r={x:this.x+n.x,y:this.y+n.y,x2:this.x+n.x+n.x2,y2:this.y+n.y2+n.y};(r.y<t.y+e.y&&r.y2>t.y+e.y||r.y>t.y+e.y&&r.y<t.y+e.y+e.y2)&&(r.x<t.x+e.x&&r.x2>t.x+e.x||r.x>t.x+e.x&&r.x<t.x+e.x+e.x2)&&(t.onCollision(this),this.onCollision(t),i=!0)}if(!i)for(var s=this.children.length,o=0;!i&&o<s;)i=this.children[o].hitTest(t),o++;return i}},{key:"setTarget",value:function(t){this.target=t}},{key:"addMoveHandler",value:function(t){this.moveHandlers.push(t)}},{key:"onHit",value:function(t){console.log("[Drawable] oops, ",this.type," [",this.id,"] ","was hit by",t.name," [",t.id,"]")}},{key:"_onUpdate",value:function(){var t=[this.x,this.y];this.moveHandlers.forEach(function(e){return e.apply(void 0,t)})}},{key:"isFxQueueEmpty",value:function(){for(var t in this.fxQueue)return!1;return!0}},{key:"animate",value:function(t,e){var i=this,n=r.a.getEffect(t),s=(new u.a).resolve(),o=e.easing||"linear",a=void 0;return void 0!==this.fxQueue[t]?console.warn("Fx",t,"already in progress, cannot execute twice"):n?(a=new n(e),a.setEasing(new r.a.getEasing(o)),s=a.start().then(function(){delete i.fxQueue[t]}).catch(function(t){console.error(t)}),this.fxQueue[t]=a):console.warn("Fx",t,"unknown: did you spell it correctly ?"),s}},{key:"stopAnimate",value:function(t){var e=this,i=null;Object.keys(this.fxQueue).forEach(function(n){i=e.fxQueue[n],i.stop(e,t)})}},{key:"executeFx",value:function(t,e){var i=this,n=null;Object.keys(this.fxQueue).forEach(function(r){n=i.fxQueue[r],n.process(t,null,i,e)})}},{key:"onCollision",value:function(){}},{key:"addChild",value:function(t){t.setMap(this.currentMap),t.setScene(this.currentScene),this.children.push(t)}},{key:"removeChild",value:function(t){var e=this.children.indexOf(t);e>-1&&(this.children[e].destroy(),this.children.splice(e,1))}},{key:"removeAllChildren",value:function(){for(var t=0;t<this.children.length;++t)this.children[t].destroy();this.children.length=0}},{key:"setImage",value:function(t){}},{key:"_draw",value:function(t){this.applyCtxAlpha(t),this.draw(t),this.restoreCtxAlpha(t)}},{key:"playSound",value:function(t,e){var i=0,n=this.currentMap,r=1,s=e||{pan:!0,loop:!1};(n&&(this.x<-n.viewportX||this.x>-n.viewportX+n.viewportW)||this.y<-n.viewportY||this.y>-n.viewportY+n.viewportH)&&(r=.2),n&&s.pan&&(i=this.x<n.masterObject.x?-5:5),this.sound=a.a.play(t,s.loop||!1,r,i)}},{key:"notify",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.a.notify(this.type+":"+t,e)}},{key:"destroy",value:function(){this._destroyed=!0,"function"==typeof this.freeFromPool&&this.freeFromPool(),this.currentMap?this.currentMap.removeObject(this):this.currentScene&&this.currentScene.removeObject(this),this.children.forEach(function(t){t.destroy()}),this.wave&&this.wave.remove(this)}}]),t}();e.a=h},/*!*********************!*\
  !*** ./js/FX/FX.js ***!
  \*********************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ./Effect/Fade */35),s=i(/*! ./Effect/Rotate */37),o=i(/*! ./Effect/Custom */34),a=i(/*! ./Effect/Mosaic */36),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l={},h={},c=function(){function t(){n(this,t),this.addEasing("linear",function(t){return t})}return u(t,[{key:"addFX",value:function(t,e){l[t]=e}},{key:"getEffect",value:function(t){return l[t]}},{key:"addEasing",value:function(t,e){h[t]=e}},{key:"getEasing",value:function(t){return h[t]||h.linear}}]),t}(),f=new c;f.addFX("Mosaic",a.a),f.addFX("Fade",r.a),f.addFX("Rotate",s.a),f.addFX("Custom",o.a),e.a=f},/*!************************!*\
  !*** ./js/Map/Tile.js ***!
  \************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e){n(this,t),this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,this.width=e.width||16,this.height=e.height||16,this.inertia=e.inertia||1,this.upCollide=e.upCollide||!0,this.downCollide=e.downCollide||!0}return r(t,null,[{key:"TYPE",get:function(){return{AIR:1,WALL:2,LADDER:3}}}]),t}();e.a=s},/*!****************************************!*\
  !*** ./js/Resource/ResourceManager.js ***!
  \****************************************/
function(t,e,i){"use strict";function n(t){return new(t.bind.apply(t,arguments))}var r=i(/*! ../Util/Binary */17),s=i(/*! ../Audio/AudioManager */7),o=i(/*! ../Util/Pool */18),a=i(/*! web-audio-daw */42),u=i.n(a),l=i(/*! ../Util/Deferred */0),h=i(/*! ../Util/Dom */6),c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=window.createImageBitmap||function(t){return l.a.resolve(t)},p={isLocal:!!document.location.href.match(/^file:\/\//),scriptMaxTime:3e3,groupMaxTime:5e3,resources:{any:{def:new l.a,loadedRes:0,numRes:0,res:{},progressCb:null,errorCb:null}},dynamicScripts:{},iOS:!!navigator.userAgent.match(/iPhone|iPad/),skipResources:["script"],async:!0,loading:!1,getResourceById:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.resources[e].res,r=n[t];return r&&r.loaded?!0===i?r:r.elt:this.dynamicScripts[t]?this.dynamicScripts[t]:void console.error("[RM] unknwon resource id",t)},newResourceFromPool:function(t){var e=this.getResourceById(t);return"function"==typeof e.createFromPool?e.createFromPool.apply(e,Array.prototype.slice.call(arguments,1)):n.apply(void 0,[e].concat(Array.prototype.slice.call(arguments,1)))},_createGroup:function(t){this._groupExists(t)?this.resources[t].def=new l.a:this.resources[t]={def:new l.a,loadedRes:0,numRes:0,res:{},progressCb:null,errorCb:null}},_groupExists:function(t){return void 0!==this.resources[t]},addResources:function(t,e){e=e||"any",this._createGroup(e);var i=void 0,n=this.resources[e];if(null!==t)if("object"===(void 0===t?"undefined":c(t))&&t.constructor===Array)for(i in t)void 0===n.res[t[i].id]&&-1===this.skipResources.indexOf(t[i].type)&&(n.res[t[i].id]=JSON.parse(JSON.stringify(t[i])),n.numRes++);else void 0===n.res[t.id]&&-1===this.skipResources.indexOf(t.type)&&(n.res[t.id]=JSON.parse(JSON.stringify(t)),n.numRes++);return null!==t&&n.numRes!==n.loadedRes||n.def.resolve(!0),n.def.promise},loadNextResource:function(t){var e=this.resources[t],i=void 0;for(i in e.res)if(!e.res[i].loaded&&-1===this.skipResources.indexOf(e.res[i].type)){this._loadResource(e.res[i],t);break}},loadResources:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(t=t||"any",!0===this.loading)return void console.warn("[ResourceManager] loadResources() -> already loading");this.loading=!0;var r=this.resources[t],s=null,o=void 0,a=0;r.progressCb=i||null,r.errorCb=n||null;for(o in r.res)r.res[o].loaded||-1!==this.skipResources.indexOf(r.res[o].type)||(a++,this.async?this._loadResource(r.res[o],t):null===s&&(s=r.res[o]));if(this.async||this._loadResource(s,t),0===a)return void(this.loading=!1);r.gpTimeout=setTimeout(function(){var t,i=[];if(r.gpTimeout){r.gpTimeout=null,console.error("[RM] Unable to load the following resources after",e.groupMaxTime/1e3,"sec");for(t in r.res)r.res[t].loaded||(i.push("["+r.res[t].type+"] "+t),console.warn("["+r.res[t].type+"] "+t+": "+r.res[t].src));r.errorCb&&r.errorCb("Unable to get all resources after",e.groupMaxTime,i)}},this.groupMaxTime)},getCanvasFromImage:function(t){var e=document.createElement("canvas");return e.width=t.naturalWidth,e.height=t.naturalHeight,e.getContext("2d").drawImage(t,0,0),e},loadImage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=new Image,n=this,r=new l.a;return i.onload=function(){f(this).then(function(s){t.elt=s,t.img=i,t.loaded=!0,e&&n._resLoaded(e),r.resolve(e&&!0||s)})},i.src=t.src,r.promise},createObjectPool:function(t,e){o.a.create(t,e)},registerScript:function(t,e,i){var n=this.dynamicScripts[t];i&&this.createObjectPool(e,i),n?console.error("existing script with the id",t,"should I replace it?"):this.dynamicScripts[t]=e},loadScript:function(t,e,i){var n=new l.a;return console.error("loadScript not supported"),console.log("[RM] loading script",t.src),n.promise},loadAudio:function(t,e){function i(){this.removeEventListener("canplaythrough",i),t.elt=this,t.loaded=!0,s.a.addSound(t.id,this),n._resLoaded(e),o.resolve(!0)}var n=this,r=new Audio,o=new l.a;return r.preload="auto",r.addEventListener("canplaythrough",i),r.addEventListener("loadstart",function(){console.log("loadStarted",r.src)}),r.src=t.src,o.promise},loadWadAudio:function(t,e){var i=this,n=new l.a,r=new u.a({source:t.src,callback:function(){t.elt=r,t.loaded=!0,s.a.addSound(t.id,r),i._resLoaded(e),n.resolve(!0)}});return n.promise},loadJSON:function(t,e,i){var n=this,r=new l.a;fetch(t.src).then(function(t){if(200===t.status)return t.json();throw"Error getting photo list"}).then(function(s){if(t.elt=s,t.loaded=!0,i){i.call(n,t,e).then(function(){r.resolve(!0)})}else n._resLoaded(e),r.resolve(!0)})},loadMapData:function(t,e){var i=this,n=new l.a,s=this.resources[e];return r.a.getArrayBuffer((document.location.href.match("warpdesign.fr")?"/gods/":"")+t.elt.dataUrl).then(function(r){t.elt.buffer=r,t.loaded=!0,i._resLoaded(e),n.resolve(!0)},function(){s.def.reject('Unable to load map resource "'+t.src+'" ['+t.id+"]")}),n.promise},_resLoaded:function(t){var e=this.resources[t];e.loadedRes++,new h.a("span.loaded").html(e.loadedRes),e.progressCb&&e.progressCb.call(this,Math.floor(100*e.loadedRes/e.numRes)),e.loadedRes===e.numRes?(this.loading=!1,null!==e.gpTimeout&&clearTimeout(e.gpTimeout),e.def.resolve(!0)):this.async||this.loadNextResource(t)},_loadResource:function(t,e){switch(t.type){case"image":return this.loadImage(t,e);case"audio":return this.loadWadAudio(t,e);case"script":return this.loadScript(t,e);default:return this.loadJSON(t,e,this.loadMapData)}}};e.a=p},/*!************************!*\
  !*** ./js/Util/Dom.js ***!
  \************************/
function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!(this instanceof r))return new(Function.prototype.bind.apply(r,[null].concat(Array.prototype.slice.call(arguments))));null!==t&&(t instanceof HTMLElement?this.push(t):t.match(/^#|\./)?this.push.apply(this,n(document.querySelectorAll(t))):this.push(document.createElement(t)))}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.prototype=new Array,Object.assign(r.prototype,{css:function(t,e){if("object"===(void 0===t?"undefined":s(t)))this.forEach(function(e){var i=e.style;for(var n in t)i[n]=t[n]});else{if(void 0===e)return this.length?this[0].style[t]:null;this.forEach(function(i){i.style[t]=e})}return this},find:function(t){var e=new r;return this.forEach(function(i){for(var n=i.querySelectorAll(t),r=0;r<n.length;++r)e.push(n[r])}),e},appendTo:function(t){var e="object"===(void 0===t?"undefined":s(t))&&t||document.querySelector(t);return e&&this.forEach(function(t){e.appendChild(t)}),this},attr:function(t,e){return"object"===(void 0===t?"undefined":s(t))?this.forEach(function(e){for(var i in t)e.setAttribute(i,t[i])}):this.forEach(function(i){i.setAttribute(t,e)}),this},addClass:function(t){var e=t.split(" ");return this.forEach(function(t){var i;(i=t.classList).add.apply(i,n(e))}),this},removeClass:function(t){var e=t.split(" ");this.forEach(function(t){var i;(i=t.classList).remove.apply(i,n(e))})},html:function(t){return this.forEach(function(e){return e.innerHTML=t}),this},show:function(){return this.forEach(function(t){t.style.display="block"}),this},hide:function(){return this.forEach(function(t){t.style.display="none"}),this}}),e.a=r},/*!**********************************!*\
  !*** ./js/Audio/AudioManager.js ***!
  \**********************************/
function(t,e,i){"use strict";var n={audioCache:{},enabled:!0,addSound:function(t,e){this.audioCache[t]=e},toggleSound:function(t){this.enabled=t},play:function(t,e,i,n){var r=null;if(this.enabled)return void 0===(r=this.audioCache[t])?void console.warn("[AM] could not find sound, did you load:",t):("function"==typeof r.loop?r.loop(e||!1):r.loop=e||!1,r.play({panning:[n||0,0,5],volume:i||1,loop:e||!1}))},stop:function(t,e){var i=null;if(this.enabled){try{i=this.audioCache[t]}catch(e){return void console.warn("[AM] WARN: unable to stop sound",t)}i&&"function"==typeof i.stop&&i.stop(e||void 0)}}};e.a=n},/*!********************************!*\
  !*** ./js/FX/Effect/Effect.js ***!
  \********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../../Util/Deferred */0),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e,i){n(this,t),this.easing=null,this.context=e.context||this,void 0!==i&&(this.width=i.width,this.height=i.height),this.startValue=void 0!==e.startValue?e.startValue:0,this.endValue=void 0!==e.endValue?e.endValue:1,this.loop=void 0===e.loop?0:e.loop,this.loops=0,this.duration=e.duration||400}return s(t,[{key:"setEasing",value:function(t){this.easing=t}},{key:"start",value:function(){return this.loops||(this.def=new r.a),this.startTime=(new Date).getTime(),this.ended=!1,this.stopped=!1,this.def.promise}},{key:"stop",value:function(t,e){this.stopped=!0}},{key:"process",value:function(t,e,i){var n=(new Date).getTime(),r=n-this.startTime,s=r/this.duration;return this.stopped||r>=this.duration?(this.loops++,this.stopped||this.loops>=this.loop?(this.animProgress=1,this.ended=!0,this.def.resolve(!0)):this.start()):this.animProgress=this.easing(s,r,0,1,this.duration),this.ended}}]),t}();e.a=o},/*!************************************************!*\
  !*** ./js/Notification/NotificationManager.js ***!
  \************************************************/
function(t,e,i){"use strict";var n={},r={notify:function(t,e){var i={type:t,data:e};n[t]?n[t].forEach(function(t){return t(i)}):n["*"]&&n["*"].forEach(function(t){return t(i)})},listen:function(t,e){console.log("[NotificationManager] listening to event(s) "+t),t.replace(/\s+/g," ").split(" ").forEach(function(t){n[t]||(n[t]=[]),n[t].push(e)})}};window.NM=r,e.a=r},/*!**********************************!*\
  !*** ./js/Input/InputManager.js ***!
  \**********************************/
function(t,e,i){"use strict";for(var n={KEYS:{UP:38,DOWN:40,LEFT:37,RIGHT:39,SPACE:32,ENTER:13,ESCAPE:27,CTRL:17},PAD_BUTTONS:{32:1,FACE_0:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_SHOULDER_BOTTOM:6,RIGHT_SHOULDER_BOTTOM:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,38:12,40:13,37:14,39:15},axes:{},newGamepadPollDelay:1e3,gamepadSupport:!1,recording:!1,playingEvents:!1,playingPos:0,recordedEvents:[],pad:null,latches:{},keyPressed:{},padPressed:{},keyCb:{},enabled:!0,inputMode:"keyboard",dPadJoystick:null,jPollInterval:0,init:function(){this._generateKeyCodes(),this._installInputModeSwitchHandler(),this._installKBEventHandlers(),this._pollNewGamepad(),this.setInputMode(this.inputMode)},_generateKeyCodes:function(){for(var t=65;t<91;++t)this.KEYS[String.fromCharCode(t)]=t},_installInputModeSwitchHandler:function(){var t=this;document.addEventListener("touchstart",function(){t.setInputMode("joystick")})},startRecordingEvents:function(){this.recording||(this.recordedEvents.length=0,this.recording=!0,console.log("[InputManager] Starting record of input events!"))},stopRecordingEvents:function(){this.recording=!1,console.log("[InputManager] Stoping record of input events, recorded",this.recordedEvents.length,"events")},playRecordedEvents:function(){this.playingEvents||(console.log("[InputManager] Starting to play an existing record of input events!"),this.playingEvents=!0,this.playPos=0)},nextRecordedEvents:function(){this.playingPos>=this.recordedEvents.length?(this.playingEvents=!1,this.keyPressed={38:!1,40:!1,37:!1,39:!1,32:!1,13:!1,27:!1,17:!1},console.log("[InputManager] Reached the end of recorded events, resetting keys status to default!")):this.keyPressed=this.recordedEvents[this.playingPos++]},recordEvents:function(){this.recordedEvents.push(JSON.parse(JSON.stringify(this.keyPressed)))},setInputMode:function(t){if(this.inputMode!==t){switch(t){case"virtual_joystick":this.dPadJoystick&&(this.jPollInterval=setInterval(this._pollJoystick.bind(this),1/30*1e3));break;case"keyboard":this._clearJoystickPoll();break;case"gamepad":this._clearJoystickPoll(),requestAnimationFrame(this._pollGamepad.bind(this))}this._resetKeys(),this.inputMode=t}},_resetKeys:function(){for(var t in this.keyPressed)this.keyPressed[t]=!1,this.latches[t]=!1},_pollNewGamepad:function(){var t=this,e=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads(),i=null;if(e&&e.length)for(var n=0;n<e.length;++n)(i=e[n])&&(this.pad=i,this.gamepadSupport||(console.log("[Event] Oh oh! Looks like we have a new challenger: ",i.id),this.gamepadSupport=!0,this.setInputMode("gamepad")));this.gamepadSupport||setTimeout(function(){t._pollNewGamepad()},this.newGamepadPollDelay)},_pollGamepad:function(){this._pollNewGamepad(),this.pad.buttons[12].pressed&&!this.latches[this.KEYS.UP]?(this.keyPressed[this.KEYS.UP]=!0,this.keyPressed[this.KEYS.DOWN]=!1):this.pad.buttons[13].pressed&&!this.latches[this.KEYS.DOWN]?(this.latches[this.KEYS.UP]=!1,this.keyPressed[this.KEYS.DOWN]=!0,this.keyPressed[this.KEYS.UP]=!1):(this.latches[this.KEYS.UP]=!1,this.latches[this.KEYS.DOWN]=!1,this.keyPressed[this.KEYS.DOWN]=!1,this.keyPressed[this.KEYS.UP]=!1),this.pad.buttons[15].pressed&&!this.latches[this.KEYS.RIGHT]?(this.keyPressed[this.KEYS.RIGHT]=!0,this.keyPressed[this.KEYS.LEFT]=!1):this.pad.buttons[14].pressed?(this.latches[this.KEYS.RIGHT]=!1,this.keyPressed[this.KEYS.LEFT]=!0,this.keyPressed[this.KEYS.RIGHT]=!1):(this.latches[this.KEYS.RIGHT]=!1,this.latches[this.KEYS.LEFT]=!1,this.keyPressed[this.KEYS.LEFT]=!1,this.keyPressed[this.KEYS.RIGHT]=!1),this.pad.buttons[0].pressed&&!this.latches[this.KEYS.SPACE]?this.keyPressed[this.KEYS.SPACE]=!0:this.pad.buttons[0].pressed||(this.latches[this.KEYS.SPACE]=!1,this.keyPressed[this.KEYS.SPACE]=!1),this.pad.buttons[1].pressed&&!this.latches[this.KEYS.CTRL]?this.keyPressed[this.KEYS.CTRL]=!0:this.pad.buttons[1].pressed||(this.latches[this.KEYS.CTRL]=!1,this.keyPressed[this.KEYS.CTRL]=!1),this.jPollInterval=requestAnimationFrame(this._pollGamepad.bind(this))},_getModifiers:function(){return{ALT:!0,SHIFT:!0,CTRL:!0,META:!0}},_initVirtualJoystick:function(){var t=this,e=void 0,i=void 0;console.log("[InputManager] _initVirtualJoystick"),e=this.dPadJoystick=new VirtualJoystick({container:document.body,strokeStyle:"cyan",limitStickTravel:!0,mouseSupport:!0,stickRadius:60}),e.addEventListener("touchStartValidation",function(t){return!(t.changedTouches[0].pageX>=window.innerWidth/2)}),i=this.fireJoystick=new VirtualJoystick({container:document.body,strokeStyle:"orange",limitStickTravel:!0,mouseSupport:!0,stickRadius:0}),i.addEventListener("touchStartValidation",function(t){return!(t.changedTouches[0].pageX<window.innerWidth/2)}),i.addEventListener("touchStart",function(){"virtual_joystick"===t.inputMode&&(t.keyPressed[t.KEYS.CTRL]=!0)}),i.addEventListener("touchEnd",function(){"virtual_joystick"===t.inputMode&&(t.keyPressed[t.KEYS.CTRL]=!1)})},_clearJoystickPoll:function(){this.jPollInterval&&(cancelAnimationFrame(this.jPollInterval),this.jPollInterval=0)},_pollJoystick:function(){var t=this,e=[],i=[],n=this.dPadJoystick;Math.abs(n.deltaX())>=10?n.left()?(e.push("LEFT"),i.push("RIGHT")):(e.push("RIGHT"),i.push("LEFT")):(i.push("LEFT"),i.push("RIGHT")),Math.abs(n.deltaY())>=10?n.up()?(e.push("UP"),i.push("DOWN")):(e.push("DOWN"),i.push("UP")):(i.push("UP"),i.push("DOWN")),e.length&&e.forEach(function(e){t.keyPressed[t.KEYS[e]]=!0}),i.length&&i.forEach(function(e){t.keyPressed[t.KEYS[e]]=!1})},_installKBEventHandlers:function(){var t=this;document.addEventListener("keydown",function(e){if("keyboard"===t.inputMode&&!t.playingEvents){switch(e.keyCode){case 32:case 37:case 38:case 39:case 40:e.preventDefault()}e.keyCode&&!t.latches[e.keyCode]&&(t.keyPressed[e.keyCode]=!0),t.metas=t._getModifiers(),t.enabled&&t.keyCb[e.keyCode]&&t.keyCb[e.keyCode].down.forEach(function(t){t(String.fromCharCode(e.keyCode),e)})}}),document.addEventListener("keyup",function(e){"keyboard"!==t.inputMode||t.playingEvents||(e.keyCode&&(t.keyPressed[e.keyCode]=!1,t.latches[e.keyCode]=!1),t.metas=t._getModifiers(),t.enabled&&t.keyCb[e.keyCode]&&t.keyCb[e.keyCode].up.forEach(function(t){t(String.fromCharCode(e.keyCode),e)}))})},getAllKeysStatus:function(){for(var t=Object.keys(this.KEYS),e={},i=0;i<t.length;++i)e[t[i]]=this.getKeyStatus(t[i]);return e},getKeyStatus:function(t,e){var i=void 0;try{return i=this.keyPressed[t]||this.padPressed[t],i&&!0===e&&(this.keyPressed[t]=!1,this.latches[t]=!0),i}catch(t){throw t}},isKeyDown:function(t,e){var i="string"==typeof t&&this.KEYS[t]||t;return this.getKeyStatus(i,e)},installKeyCallback:function(t,e,i){var n=this;t.split(" ").forEach(function(t){var r=n.KEYS[t];n.keyCb[r]||(n.keyCb[r]={up:[],down:[]}),n.keyCb[r][e].push(i)})},removeKeyCallback:function(t,e,i){var n=this.keyCb[t][e].indexOf(i);n>-1&&this.keyCb[t][e].splice(n,1)},clearEvents:function(){this.keyPressed={},this.keyCb={}}},r=0;r<10;++r)n.KEYS[r.toString()]=r+48;[].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}("ABCDEFGHIJKLMNOPQRSTUVWXYZ")).forEach(function(t,e){n.KEYS[t]=65+e}),e.a=n},/*!*******************************!*\
  !*** ./js/Display/Display.js ***!
  \*******************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../FX/FX */3),s=i(/*! ../Util/Deferred */0),o=i(/*! ../Util/Dom */6),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function(){function t(e,r){n(this,t);var s=function(){var t=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||""===t.OLink&&["","o"])[1];return{dom:"WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1],lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}}();this.layers=new Array(e.layers.length+1),this.layersIndex=e.layers,this.sortedLayers=this._sortLayers(),this.prefix=s.lowercase,this.target=r||i.i(o.a)("div").attr("id","display_"+e.name).appendTo("body")[0],this.width=e.width,this.height=e.height,this.type=e.type||"2d",this.fxCtx=null,this.isFullscreen=!1,this._addFullscreenEvents(),this._createLayers(),this.fxQueue={pre:{},post:{}}}return a(t,[{key:"getBuffer",value:function(t,e){var n=i.i(o.a)("canvas").attr({width:t+"px",height:e+"px"})[0].getContext("2d");return n.imageSmoothingEnabled=!1,n}},{key:"_addFullscreenEvents",value:function(){var t=this.target;t.addEventListener("webkitfullscreenchange",this._onFullscreenChange.bind(this),!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange.bind(this),!1),t.addEventListener("fullscreenchange",this._onFullscreenChange.bind(this),!1),t.addEventListener("MSFullscreenChange",this._onFullscreenChange.bind(this),!1)}},{key:"_onFullscreenChange",value:function(){var t=document.webkitFullscreenElement||document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(this.isFullscreen=t===this.target,this.isFullscreen){var e=this._getFullScreenSize(this.width,this.height);console.log("size",e.scaleX,e.scaleY),i.i(o.a)(this.target).css({width:e.width+"px",height:e.height+"px"}).find("canvas").css({width:e.width+"px",height:e.height+"px",top:e.top+"px",left:e.left+"px"})}else i.i(o.a)(this.target).css({width:this.width+"px",height:this.height+"px"}).find("canvas").css({width:this.width+"px",height:this.height+"px",top:0,left:0})}},{key:"_getFullScreenSize",value:function(t,e){var i,n,r=t/e,s=navigator.userAgent.match(/Edge|Firefox/),o=navigator.userAgent.match(/Edge/),a=screen.width,u=screen.height;return o&&(a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,u=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),console.log("screen",screen.width,screen.height),r>0?(n=u,i=n*r):(i=a,n=i*r),{width:i,height:n,scaleX:i/t,scaleY:n/e,top:s?(u-n)/2:0,left:s?(a-i)/2:0}}},{key:"toggleFullscreen",value:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?(console.log("request fullscreen"),this.target.requestFullScreen=this.target.requestFullscreen||this.target.webkitRequestFullscreen||this.target.mozRequestFullScreen||this.target.msRequestFullscreen,this.target.requestFullScreen?this.target.requestFullScreen():console.warn("Request fullscreen support not detected.")):(console.log("exit fullscreen"),document.exitFullScreen=document.exitFullscreen||document.webkitExitFullscreen||document.mozExitFullScreen||document.msExitFullscreen,document.exitFullScreen?document.exitFullScreen():console.log("Exit fullscreen support not detected."))}},{key:"_createLayers",value:function(){var t=void 0;for(t=0;t<this.layers.length;++t)this.layers[t]=i.i(o.a)("canvas").addClass("layer_"+t).attr({width:this.width,height:this.height}).css({width:this.width+"px",height:this.height+"px",position:"absolute",zIndex:this._getLayerZIndex(t)}).appendTo(this.target)[0].getContext(this.type),this.layers[t].imageSmoothingEnabled=!1;this.fxCtx=i.i(o.a)("canvas").addClass("fx").attr({width:this.width,height:this.height}).css({width:this.width+"px",height:this.height+"px",position:"absolute",zIndex:3}).appendTo(this.target)[0].getContext(this.type),this.fxCtx.imageSmoothingEnabled=!1}},{key:"_getLayerZIndex",value:function(t){if(t<this.layersIndex.length){return this.layersIndex[t]?0:2}return 1}},{key:"_sortLayers",value:function(){var t=[];return this.layersIndex.forEach(function(e,i){e&&t.push(i)}),t.push(this.layers.length-1),this.layersIndex.forEach(function(e,i){e||t.push(i)}),t}},{key:"setLayerZIndex",value:function(t,e){t<this.layers.length&&(i.i(o.a)(this.layers[t].canvas).css("zIndex",e),this.layersIndex[t]=0===e,this.orderedLayers=this._sortLayers())}},{key:"clearScreen",value:function(t){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.width,this.height)}},{key:"clearAllScreens",value:function(){for(var t=0;t<this.layers.length;++t)this.clearScreen(this.layers[t]);this.clearScreen(this.fxCtx)}},{key:"setCanvasOpacity",value:function(t,e){t.style.opacity=e}},{key:"renderScene",value:function(t){this.clearScreen(this.fxCtx),this.executeFx(null,null,t,null,"pre");for(var e=0;e<this.layers.length;++e)this.setCanvasOpacity(this.layers[e].canvas,Object.keys(this.fxQueue.post).length?0:t.getOpacity());for(var i=0;i<this.layers.length-1;i++)this.clearScreen(this.layers[i]);if(t.render(this.layers),t.hudScene&&t.hudScene.render(this.layers),Object.keys(this.fxQueue.post).length){this.clearScreen(this.fxCtx),this.setCanvasOpacity(this.fxCtx.canvas,0);for(var n=0;n<this.layers.length;++n){var r=this.sortedLayers[n];this.fxCtx.drawImage(this.layers[r].canvas,0,0)}}this.executeFx(this.fxCtx,this.fxCtx,t,null,"post"),Object.keys(this.fxQueue.post).length&&this.setCanvasOpacity(this.fxCtx.canvas,1)}},{key:"prepareCanvas",value:function(t){var e=null,i=0,n="";for(i=0;i<this.layers.length;++i)e=this.layers[i],n=e.canvas.style.display,e.canvas.style.display="none",t.forEach(function(t){"image"===t.type&&e.drawImage(t.elt,0,0)}),this.clearScreen(e),e.canvas.style.display=n}},{key:"animate",value:function(t,e,i){var n,o,a=this,u=r.a.getEffect(t),l=e.easing||"linear",h=e.when||"pre";if(e.context=i||this,void 0!==this.fxQueue[h][t]){console.warn("[Display] animate() - "+t+" already in progress, cannot execute twice.");var c=new s.a;c.resolve(),n=c.promise}else u?(o=new u(e,this),o.setEasing(new r.a.getEasing(l)),n=o.start().then(function(){delete a.fxQueue[h][t]}).catch(function(t){console.error(t)}),this.fxQueue[h][t]=o):console.warn("[Display] animate() - "+t+" unknown: did you spell it correctly ?");return n}},{key:"stopAnimate",value:function(){console.log("TODO: need to stop animation")}},{key:"executeFx",value:function(t,e,i,n,r){var s;r=r||"pre";for(var o in this.fxQueue[r])s=this.fxQueue[r][o],s.process(t,e,i,n)}},{key:"clearDisplay",value:function(){this.fxQueue.pre={},this.fxQueue.post={},this.clearAllScreens()}}]),t}();e.a=u},/*!**************************************!*\
  !*** ./js/Display/DisplayManager.js ***!
  \**************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ./Display */11),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){n(this,t),this.displays={}}return s(t,[{key:"addDisplay",value:function(t,e){return console.log("[Display Manager] adding display",t.name),this.displays[t.name]=new r.a(t,e),this.displays[t.name]}},{key:"getDisplay",value:function(t){return this.displays[t]}}]),t}();e.a=new o},/*!***********************************!*\
  !*** ./js/Drawable/SimpleText.js ***!
  \***********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Drawable */2),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},l=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SimpleText"+(new Date).getTime(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.fontFace=i.fontFace||"Arial",s.fontStyle=i.fontStyle||"normal",s.fontSize=i.fontSize||"18px",s.fontWeight=i.fontWeight||"normal",s.align=i.align||"center",s.color=i.color||"white",s.width=i.width||0,s.height=i.height||0,s.buffer=null,s.text=i.text||"",s}return s(e,t),a(e,[{key:"createBuffer",value:function(t){var e=this.fakeWidth||0,i=this.fakeHeight||0;this.buffer=t.getBuffer(e,i)}},{key:"clearBuffer",value:function(){this.currentScene.display.clearScreen(this.buffer)}},{key:"moveWithSpline",value:function(){}},{key:"setSize",value:function(t,e){null!==t&&(this.width=t),null!==e&&(this.height=e)}},{key:"prepareRender",value:function(){this._setFont(),this.lines=this.text.split("\n"),this.buffer?this.clearBuffer():this.createBuffer(this.currentScene.display),this.getMetrics()}},{key:"getMetrics",value:function(){var t=this.buffer;t.font=this.font,this.fakeLineHeight=parseInt(t.font),this.fakeHeight=this.lines.length*this.fakeLineHeight,this.fakeWidth=t.measureText(this.text).width,t.canvas.width=this.fakeWidth,t.canvas.height=this.fakeHeight,t.fillStyle=this.color,t.font=this.font,t.textBaseline="top"}},{key:"renderText",value:function(){this.prepareRender();for(var t=0;t<this.lines.length;++t)this.buffer.fillText(this.lines[t],0,this.fakeLineHeight*t)}},{key:"setText",value:function(t){this.text=t,this.renderText()}},{key:"setScene",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScene",this).call(this,t),this.setText(this.text)}},{key:"setColor",value:function(t){this.color=t,this.renderText()}},{key:"getHitBox",value:function(){return{x:0,y:0,x2:this.w,y2:this.y}}},{key:"getCurrentWidth",value:function(){return this.fakeWidth}},{key:"getCurrentHeight",value:function(){return this.fakeHeight}},{key:"getCurrentOffsetX",value:function(){return this.offsetX}},{key:"getCurrentOffsetY",value:function(){return this.offsetY}},{key:"onHit",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onHit",this).call(this,t),console.log("oops, ",this.type," [",this.id,"] ","was hit by",t.name," [",t.id,"]")}},{key:"draw",value:function(t){var e=this.fakeWidth*this.scale,i=this.fakeHeight*this.scale,n=Math.floor(e/2),r=Math.floor(i/2),s=this.currentMap&&this.currentMap.viewportX||0,o=this.currentMap&&this.currentMap.viewportY||0,a=this.fakeWidth,u=this.fakeHeight;this.visible&&this.buffer&&(this.executeFx(t),t.setTransform(this.scale,0,0,this.scale,this.x+s+n,this.y+o+r),t.rotate(this.angle),t.drawImage(this.buffer.canvas,0,0,Math.floor(a),Math.floor(u),Math.floor(-n),Math.floor(-r),Math.floor(e),Math.floor(i)))}},{key:"_setFont",value:function(){this.font=this.fontSize+" "+this.fontFace}}]),e}(o.a);e.a=l},/*!*****************************!*\
  !*** ./js/Drawable/Wave.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../Resource/ResourceManager */5),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){n(this,t),this.counter=e.size,this.type=e.afterDestroy,this.data=e.afterDestroyData}return s(t,[{key:"remove",value:function(t){--this.counter||this.destroy(t)}},{key:"getSpriteOptions",value:function(t){var e=Object.assign({},this.data.spriteOptions);return"string"==typeof e.x&&(e.x=t.x+Number(e.x)),"string"==typeof e.y&&(e.y=t.y+Number(e.y)),e}},{key:"destroy",value:function(t){switch(this.type){case"reward":if(this.data){var e=this.getSpriteOptions(t,this.data),i=new(r.a.getResourceById(this.data.spriteId))(e);t.currentMap.addObject(i)}break;default:throw this.type}}}]),t}();e.a=o},/*!***********************!*\
  !*** ./js/Map/Map.js ***!
  \***********************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ./Tile */4),s=i(/*! ../Resource/ResourceManager */5),o=i(/*! ../Notification/NotificationManager */9),a=i(/*! ../FX/FX */3),u=i(/*! ./MapEvent */16),l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();window.maps={};var h=function(){function t(e){n(this,t),this.options=e,this.src=e.src,this.tileWidth=e.tileWidth||64,this.tileHeight=e.tileHeight||32,this.width=e.width||1024,this.height=e.height||1024,this.addTileSet(e.tiles),this.viewportX=e.viewportX||0,this.viewportY=e.viewportY||0,this.viewportW=e.viewportW||this.width,this.viewportH=e.viewportH||this.height,this.triggers=e.triggers||{},this.windows=e.windows||{},this.maxWinX=this.width/this.viewportW|0,this.xMax=this.width-this.viewportW,this.yMax=this.height-this.viewportH,this.viewportTargetX=this.viewportTargetY=this.viewportSpeedX=this.viewsportSpeedY=this.viewportStartX=this.viewportStartY=0,this.viewportLimitX=230,this.viewportCenterX=307,this.viewportLimitY=154,this.viewportCenterY=230,this.tileOffsetX=0,this.tileOffsetY=0,this.scrollTileWidth=0,this.scrollTileHeight=0,this.viewportLimits={x1:this.viewportLimitX,x2:this.viewportW-this.viewportLimitX,y1:this.viewportLimitY,y2:this.viewportH-this.viewportLimitY},this.objects=[],this.friendBullets=[],this.enemies=[],this.platforms=[],this.name=e.name||"map"+(new Date).getTime(),this._calcNumTiles(!1),this.setBuffer(e.buffer),this.dataUrl=e.dataUrl,this.firstRow=this.lastRow=this.firstCol=this.lastCol=0,this.isDebug=!1,this.srcBitmap=null,this.moving=!1,this.setEasing(e.easing),this.startMoveTime=null,this.duration=800,this.masterObject=null,this.currentWindow=null,this.startX=e.startX||0,this.startY=e.startY||0,window.maps[this.name]=this,this.mapEvent=new u.a(this),this.scene=null,this.isDirty=!0}return l(t,[{key:"setStartXYFromMaster",value:function(){this.startX=this.masterObject.x,this.startY=this.masterObject.y}},{key:"setEasing",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"linear";this.easing=a.a.getEasing(t)}},{key:"respawn",value:function(){console.log("avant",this.masterObject.running,this.masterObject.currentAnimName),this.masterObject.reset(),console.log("apres",this.masterObject.running,this.masterObject.currentAnimName),console.log("resuming",this.startX,this.startY),this.masterObject.x=this.startX,this.masterObject.y=this.startY,this.isDirty=!0}},{key:"reset",value:function(){this.masterObject=null,this.objects.length=0,this.friendBullets.length=0,this.enemies.length=0,this.platforms.length=0;for(var t in this.windows)this.windows[t].displayed=!1;for(var e in this.triggers)this.triggers[e].triggered=!1;this.mapEvent.reset(),this.viewportX=this.options.viewportX||0,this.viewportY=this.options.viewportY||0,this.viewportW=this.options.viewportW||0,this.viewportH=this.options.viewportH||0,this.tileOffsetX=0,this.tileOffsetY=0,this.scrollTileWidth=0,this.scrollTileHeight=0,this.firstCol=-this.viewportX/this.tileWidth,this.firstRow=-this.viewportY/this.tileHeight,this.lastCol=this.firstCol+this.numViewportCols,this.lastRow=this.firstRow+this.numViewportRows,this.startX=this.options.startX||0,this.startY=this.options.startY||0,this.isDirty=!0}},{key:"setScene",value:function(t){this.scene=t}},{key:"setBuffer",value:function(t){var e=this.numCols*this.numRows;this.map=new Uint8Array(t,0,e),this.tileBehaviors=new Uint8Array(t,e),this.buffer=t}},{key:"setData",value:function(t,e){var i=this.numCols*this.numRows,n=new Uint8Array(2*i);n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),i),this.buffer=n.buffer,this.map=new Uint8Array(this.buffer,0,i),this.tileBehaviors=new Uint8Array(this.buffer,i,i)}},{key:"setMasterObject",value:function(t){this.masterObject=t,t.x=this.startX,t.y=this.startY}},{key:"addObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!t.image&&t.imageId&&t.setImage(s.a.getResourceById(t.imageId)),t.setMap(this),t.setScene(this.scene),t.layer=e,this.objects.push(t),!0===t.master&&this.setMasterObject(t),1===t.collideGroup?this.enemies.push(t):2===t.collideGroup?this.friendBullets.push(t):3===t.collideGroup&&(console.log("[Map] adding platform "+t.id),this.platforms.push(t))}},{key:"setTilesSize",value:function(t,e){this.tileWidth=t,this.tileHeight=e}},{key:"setViewPort",value:function(t,e,i,n){this.viewportX=t,this.viewportY=e,this.viewportW=i,this.viewportH=n}},{key:"debug",value:function(t){this.isDebug=t,this.isDirty=!0}},{key:"moveObjects",value:function(t){this.objects.forEach(function(e){3!==e.collideGroup&&e.movable&&e.update(t)})}},{key:"movePlatforms",value:function(t){this.platforms.forEach(function(e){e.movable&&e.update(t)})}},{key:"update",value:function(t){var e=0,i=0,n=0;!0===this.moving?(e=t-this.startMoveTime,i=e/this.duration,e>=this.duration?(this.moving=!1,this.viewportX=this.viewportTargetX,this.viewportY=this.viewportTargetY):(n=this.easing(i,e,0,1,this.duration),this.viewportX=this.viewportStartX+n*this.viewportSpeedX|0,this.viewportY=this.viewportStartY+n*this.viewportSpeedY|0),this.isDirty=!0):this.masterObject&&(this.checkMasterPosition(),this.checkForTriggers()),this.movePlatforms(t),this.moveObjects(t)}},{key:"checkMasterPosition",value:function(){var t=null,e=null;this.masterObject&&!this.moving&&(this.viewportX&&this.masterObject.x+this.viewportX<=this.viewportLimitX?t=this.viewportX+this.viewportCenterX:-this.viewportX+this.viewportW-this.masterObject.x<=this.viewportLimitX&&(t=this.viewportX-this.viewportCenterX),this.viewportY&&this.masterObject.y+this.viewportY<=this.viewportLimitY?e=this.viewportY+this.viewportCenterY:-this.viewportY+this.viewportH-this.masterObject.y<=this.viewportLimitY&&(e=this.viewportY-this.viewportCenterY),null===t&&null===e||this.moveTo(null!==t?t:this.viewportX,null!==e?e:this.viewportY),null===t&&null===e||this.moveTo(null!==t?t:this.viewportX,null!==e?e:this.viewportY))}},{key:"checkCollisions",value:function(){this.masterObject&&this.masterObject.canCollide&&this.checkMasterToEnemiesCollisions(),this.checkMasterBulletsToEnemiesCollisions()}},{key:"checkForTriggers",value:function(){var t=this,e=this.masterObject.getHitBox();this.getTriggersForBox(this.masterObject.x+e.x,this.masterObject.y+e.y,this.masterObject.x+e.x2,this.masterObject.y+e.y2).forEach(function(e){e.triggered=!t.mapEvent.handleEvent(e)})}},{key:"moveTo",value:function(t,e){var i=t<-this.xMax?-this.xMax:t,n=e<-this.yMax?-this.yMax:e;this.moving||this.viewportX===i&&this.viewportY===n||(this.masterObject&&this.masterObject.savePosition(),this.viewportTargetX=i>0?0:i,this.viewportTargetY=n>0?0:n,this.startMoveTime=(new Date).getTime(),this.viewportSpeedX=i-this.viewportX|0,this.viewportSpeedY=n-this.viewportY|0,this.viewportStartX=this.viewportX,this.viewportStartY=this.viewportY,this.moving=!0)}},{key:"setNewSrc",value:function(t){this.src=t.src}},{key:"getSrc",value:function(){return this.src}},{key:"fallTest",value:function(t,e){var i=this.getTileIndexFromPixel(t,e);return this.tileBehaviors[i.x+i.y*this.numCols]===r.a.TYPE.WALL}},{key:"checkMasterBulletsToEnemiesCollisions",value:function(){var t=0,e=0,i=this.friendBullets.length,n=this.enemies.length;for(t=0;t<i;++t)for(e=0;e<n;++e)this.enemies[e]&&this.enemies[e].canCollideFriendBullet&&this.friendBullets[t]&&this.friendBullets[t].hitTest(this.enemies[e])}},{key:"checkMasterToEnemiesCollisions",value:function(){for(var t=0,e=this.enemies.length,i=!1;t<e&&!i;)i=this.enemies[t].hitTest(this.masterObject),t++;return i}},{key:"checkForPlatform",value:function(t,e,i){var n=t.getHitBox();n.x,sprite.x,n.y,sprite.y;return this.platforms.forEach(function(t){var e=t.getHitBox();t.x,e.x,t.y,e.y}),!1}},{key:"getTriggersForBox",value:function(t,e,i,n){var r=this.getTileIndexFromPixel(t,e),s=this.getTileIndexFromPixel(i,e),o=this.getTileIndexFromPixel(t,n),a=s.x,u=o.y,l=void 0,h=void 0,c=[],f=null;for(l=r.x;l<=a;l++)for(h=r.y;h<=u;h++)(f=this.triggers[h*this.numCols+l])&&!f.triggered&&c.push(f);return c}},{key:"checkMatrixForCollision",value:function(t,e,i,n,r){var s=e/this.tileWidth,o=t.length/s,a=0,u=0,l=!1;for(a=0;a<o;++a)for(u=0;u<s;++u)l=l||t[a*s+u]&&this.getTileBehaviorAtIndex(i+u,n+a)===r;return l}},{key:"getMaxDistanceToTile",value:function(t,e,i){for(var n=!1,r=t.getHitBox2(),s=e<0,o=s?-this.tileWidth:this.tileWidth,a=s?-1:1,u=this.getTileIndexFromPixel(s?r.x+a:r.x2+a,r.y),l=u.y,h=l+Math.floor((r.y2-r.y)/this.tileHeight),c=0;!n&&Math.abs(a)<Math.abs(e);){for(c=l;c<=h;++c)n=n||this.getTileBehaviorAtIndex(u.x,c)===i;n||(a+=o,u=this.getTileIndexFromPixel(s?r.x+a:r.x2+a,r.y))}return n?Math.abs(a)>1?a-o:0:e}},{key:"setNextX",value:function(t,e){for(var i=!(t.vx>0),n=t.getHitBox(),r=t.y+n.y2,s=i?t.x+n.x-1:t.x+n.x2+1,o=t.y+n.y,a=this.getTileIndexFromPixel(s,o),u=!1,l=i?s:0;!u&&(i&&l>=t.vx||!i&&l<=t.vx);){for(var h=a.y*this.tileHeight;h<r;h+=this.tileHeight,a.y++)if(this.tileBehaviors[a.y*this.numCols+a.x]===e){u=!0;break}u||(l=i?a.x*this.tileWidth-s:++a.x*this.tileWidth-s),s=i?a.x*this.tileWidth-1:a.x*this.tileWidth,a=this.getTileIndexFromPixel(s,o)}return i&&t.vx>=l||!i&&t.vx<l?(t.x+=t.vx,!1):(console.log("**collision"),t.x+=l,!0)}},{key:"setNextYTop",value:function(t,e){var i=t.getHitBox,n=(t.x,i.x2,t.x+i.x),r=t.y+i.x2+1;this.getTileIndexFromPixel(n,r);t.y+=t.vy}},{key:"checkForTileType",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=t.getHitBox(),o=this.hitObjectTest(s.x+t.x+i,s.y+t.y+n,s.x2+t.x-i,s.y2+t.y-n,e);return!!o&&(r&&t.centerXOverTile(o),!0)}},{key:"hitObjectTest",value:function(t,e,i,n,r){var s=this.getTileIndexFromPixel(t,e),o=this.getTileIndexFromPixel(i,e),a=this.getTileIndexFromPixel(t,n),u=o.x,l=a.y,h=void 0,c=void 0;for(h=s.x;h<=u;h++)for(c=s.y;c<=l;c++)if(this.tileBehaviors[c*this.numCols+h]===r)return{x:h,y:c,tile:{x:h*this.tileWidth,y:c*this.tileHeight}};return!1}},{key:"drawTile",value:function(t,e,i,n,r,s){var o=this.tiles[t];e.drawImage(this.srcBitmap,o.offsetX+(r&&this.tileOffsetX)||0,o.offsetY+(s&&this.tileOffsetY)||0,r?this.scrollTileWidth:o.width,s?this.scrollTileHeight:o.height,i,n,r?this.scrollTileWidth:o.width,s?this.scrollTileHeight:o.height)}},{key:"_getTileOffset",value:function(){var t=Math.abs(this.viewportX),e=Math.abs(this.viewportY);this.tileOffsetX=t<this.tileWidth?t:t%this.tileWidth,this.tileOffsetY=e<this.tileHeight?e:e%this.tileHeight,this.scrollTileWidth=this.tileWidth-this.tileOffsetX,this.scrollTileHeight=this.tileHeight-this.tileOffsetY}},{key:"draw",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=void 0,o=void 0,a=void 0,u=void 0,l=0,h=0,c=0;if(!this.tiles.length)return void(this.isDirty=!1);if(!this.srcBitmap&&(this.srcBitmap=s.a.getResourceById(this.src),!this.srcBitmap))throw"no source bitmap found when drawing map";if(r=o=a=u=0,!this.isDirty&&this.lastCol||this._getBoundariesTiles(e),this.isDirty||!this.lastCol){for(this._getTileOffset(),r=this.firstRow,a=this.lastRow,c=n;r<a;r++){for(o=this.firstCol,u=this.lastCol,h=i;o<u;o++)l=this.map[r*this.numCols+o],l<255&&this.drawTile(l,t,h,c,!(!this.viewportX||o!==this.firstCol),!(!this.viewportY||r!==this.firstRow)),this.viewportX&&o===this.firstCol?h+=this.scrollTileWidth:h+=this.tileWidth;this.viewportY&&r===this.firstRow?c+=this.scrollTileHeight:c+=this.tileHeight}!0===this.isDebug&&this.showTileBehaviors(t,e,i,n),this.checkVisibleWindows(),this.isDirty=!1}}},{key:"addNewObjectsFromWindow",value:function(t){var e=this,i=this.windows[t];i&&!1===i.displayed&&(i.displayed=!0,i.items.forEach(function(t){var i=s.a.newResourceFromPool(t.type,t.spriteOptions);e.addObject(i),t.itemId&&e.mapEvent.addItem(t.itemId,i)}))}},{key:"checkVisibleWindows",value:function(){for(var t=Math.abs(this.viewportY)/this.viewportH*this.maxWinX|0,e=this.viewportY%this.viewportH?t+this.maxWinX:t,i=this.viewportX%this.viewportW,n=t;n<=e;n+=this.maxWinX)this.addNewObjectsFromWindow(n),i&&this.addNewObjectsFromWindow(n+1)}},{key:"drawObjects",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=void 0,s=void 0,o=this.objects.length,a=this.objects,u=null,l=null;for(r=o-1;r>=0;r--)!function(){u=a[r];var o=u.layer;if((i||n)&&(u.x+=i,u.y+=n,u.children.length))for(s=0;s<u.children.length;++s)l=u.children[s],l.x+=i,l.y+=n;if(u._draw(t[o]),e.isDebug&&u.showHitBox(t[o]),u.children.length&&u.children.forEach(function(i){i._draw(t[o]),e.isDebug&&i.showHitBox(t[o])}),(i||n)&&(u.x-=i,u.y-=n,u.children.length))for(s=0;s<u.children.length;++s)l=u.children[s],l.x-=i,l.y-=n}()}},{key:"getTileAt",value:function(t,e){var i=void 0,n=void 0,r=void 0;return i=t/this.tileWidth|0,n=e/this.tileHeight|0,r=this.map[this.numCols*n+i],this.tiles[r]}},{key:"getTileBehaviorAtIndex",value:function(t,e){return this.tileBehaviors[this.numCols*e+t]}},{key:"getTileIndexFromPixel",value:function(t,e){var i=void 0,n=void 0;return i=t/this.tileWidth|0,n=e/this.tileHeight|0,{x:i,y:n}}},{key:"getTilePixelPos",value:function(t,e){return{y:e*this.tileHeight,x:t*this.tileWidth}}},{key:"_calcNumTiles",value:function(){this.numCols=this.width/this.tileWidth|0,this.numRows=this.height/this.tileHeight|0,this.numViewportCols=Math.ceil(this.viewportW/this.tileWidth),this.numViewportRows=Math.ceil(this.viewportH/this.tileHeight)}},{key:"_getBoundariesTiles",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(this.firstCol=0,this.firstRow=0,this.lastCol=this.width/this.tileWidth|0,this.lastRow=this.height/this.tileHeight|0):(this.firstCol=Math.floor(-this.viewportX/this.tileWidth),this.firstRow=Math.floor(-this.viewportY/this.tileHeight),this.lastCol=this.firstCol+this.numViewportCols,this.lastRow=this.firstRow+this.numViewportRows,this.viewportX%this.tileWidth&&this.lastCol++,this.viewportY%this.tileHeight&&this.lastRow++)}},{key:"notify",value:function(t,e){o.a.notify(t,e)}},{key:"removeObject",value:function(t){var e=this.objects.indexOf(t);e>-1&&this.objects.splice(e,1),e=this.enemies.indexOf(t),e>-1?this.enemies.splice(e,1):(e=this.friendBullets.indexOf(t))>-1&&this.friendBullets.splice(e,1)}},{key:"showTileBehaviors",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=void 0,s=void 0,o=void 0,a=void 0,u=0,l=0,h=[null,null,"rgba(240,0,0,.6)","rgba(0,0,240,.6)"],c=void 0,f=void 0;for(r=s=o=a=0,r=this.firstRow,o=this.lastRow,l=n;r<o;r++){for(s=this.firstCol,a=this.lastCol,u=i;s<a;s++)c=this.viewportX&&s===this.firstCol?this.scrollTileWidth:this.tileWidth,f=this.viewportY&&r===this.firstRow?this.scrollTileHeight:this.tileHeight,this.tileBehaviors[r*this.numCols+s]>1&&(t.fillStyle=h[this.tileBehaviors[r*this.numCols+s]],t.beginPath(),t.moveTo(u,l),t.lineTo(u+c,l),t.lineTo(u+c,l+f),t.lineTo(u,l+f),t.lineTo(u,l),t.closePath(),t.fill()),this.viewportX&&s===this.firstCol?u+=this.scrollTileWidth:u+=this.tileWidth;this.viewportY&&r===this.firstRow?l+=this.scrollTileHeight:l+=this.tileHeight}}},{key:"getObjectsList",value:function(){this.objects.forEach(function(t,e){console.log("["+e+"]",t.type,"("+t.id+")")})}},{key:"toString",value:function(){var t=0,e=this.tiles.length,i={src:this.src,viewportX:0,viewportY:0,viewportW:this.viewportW,viewportH:this.viewportH,width:this.width,height:this.height,tileWidth:this.tileWidth,tileHeight:this.tileHeight,map:this.map,objects:this.objects,tiles:[]};for(t=0;t<e;t++)i.tiles.push("new Tile({offsetX: tile.offsetX,offsetY: tile.offsetY,width: tile.width,height: tile.height,inertia: tile.inertia,upCollide: tile.upCollide,downCollide: tile.downCollide}),");return JSON.stringify(i)}},{key:"_createTiles",value:function(t){var e=[];return t.forEach(function(t){e.push(new r.a(t))}),e}},{key:"addTileSet",value:function(t){t&&t.length?this.tiles=this._createTiles(t):this.tiles=[],this.isDirty=!0}},{key:"clear",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.a.TYPE.AIR,i=0;i<this.numCols;++i)for(var n=0;n<this.numRows;++n)this.map[n*this.numCols+i]=t,this.tileBehaviors[n*this.numCols+i]=e}},{key:"updateTile",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=e*this.numCols+t;i>-1&&(this.map[r]=i,this.isDirty=!0),n>-1&&(this.isDirty=!0,this.tileBehaviors[r]=n)}},{key:"shift",value:function(t,e,i){var n=new Uint8Array(this.buffer,0,t*this.numCols),r=new Uint8Array(this.buffer,this.numCols*this.numRows,t*this.numCols),s=e*this.numCols;this.map.set(n,s),this.tileBehaviors.set(r,s),this.isDirty=!0}},{key:"resize",value:function(t,e){var i=null,n={},r={},s=new Array(this.numCols*this.numRows),o=null,a=null,u=null;if("bottomleft"!==t)throw"resize not supported for direction"+t;var l=(e.newWidth,this.width,e.newHeight-this.height),h=e.newWidth/this.tileWidth|0,c=e.newHeight/this.tileHeight|0,f=(this.numCols,c-this.numRows),p=this.width/this.viewportW|0,d=this.height/this.viewportH|0,v=(e.newWidth,this.viewportW,e.newHeight/this.viewportH|0),y=v-d;i=new ArrayBuffer(h*c*2),o=new Uint8Array(i,0,c*h),s=new Uint8Array(i,c*h,c*h);for(var m=f;m<c;m++)for(var g=0;g<this.numCols;g++)o[m*h+g]=this.map[m*h+g],s[m*h+g]=this.tileBehaviors[m*h+g],this.triggers[m*h+g]&&(a=Object.assign({},!0,this.triggers[m*h+g]),a.spriteOptions&&(a.spriteOptions.y+=l),n[m*h+g]=a);this.setBuffer(i),this.width=e.newWidth,this.height=e.newHeight,this.triggers=n,this._calcNumTiles();for(var b=y;b<v;++b)for(var w=0;w<p;++w)if(this.windows[b*p+w]){u=this.windows[b*p+w].items;for(var k=0;k<u.length;++k)a=Object.assign({},u[k]),a.spriteOptions&&(a.spriteOptions.y+=l);r[b*p+w]={displayed:!1,items:u.slice(0)}}this.windows=r}}]),t}();e.a=h},/*!****************************!*\
  !*** ./js/Map/MapEvent.js ***!
  \****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../Resource/ResourceManager */5),s=i(/*! ../Drawable/Wave */14),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function t(e){n(this,t),console.log("[MapEvent] constructor()"),this.map=e||null,this.reset()}return o(t,[{key:"reset",value:function(){this.switches={},this.events=[],this.items={}}},{key:"addItem",value:function(t,e){this.items[t]=e}},{key:"getItem",value:function(t){return this.items[t]}},{key:"setSwitch",value:function(t,e){this.switches[t]=e}},{key:"toggleSwitch",value:function(t){this.setSwitch(t,void 0===this.switches[t]||!this.switches[t])}},{key:"getSwitch",value:function(t){return this.switches[t]||!1}},{key:"checkConditions",value:function(t){var e,i,n=t.conditions,r=null,s=!0;if(n){for(e=0,i=n.length;e<i;e++){switch(r=n[e],r.type){case"time":break;case"switch":s=this.getSwitch(r.id)===r.status}if(!s)break}return s}return!0}},{key:"handleAction",value:function(t){var e;switch(t.type){case"toggleSwitch":e=t.sprite,e.toggleSwitch(),this.toggleSwitch(e.id);break;default:console.log("[MapEvent] non-handled action type",t.type)}}},{key:"handleEvent",value:function(t){var e=t.type,i=null;if(!this.checkConditions(t))return!0;switch(e){case"cp":this.map.setStartXYFromMaster();break;case"message":this.map.notify("game:message",{message:t.message});break;case"wave":return this.handleWave(Object.assign({},t));case"explosion":this.scheduleSprite(t.spriteId,t.spriteOptions,0),i=this.getItem(t.targetId),i.destroy();break;default:console.log("non-handled Event",t.type)}}},{key:"scheduleSprite",value:function(t,e,i){var n=this,s=r.a.newResourceFromPool(t,e);return i?setTimeout(function(){n.map.addObject(s)},i):this.map.addObject(s),s}},{key:"handleWave",value:function(t){var e=t.size,i=new s.a(t),n=0,r=0;for(t.spriteOptions.wave=i,n=0;n<e;n++)this.scheduleSprite(t.spriteId,t.spriteOptions,r),r+=t.delay||0;return!1}},{key:"endWave",value:function(){}},{key:"triggerEvent",value:function(t){this.events.push(t)}},{key:"isEventTriggered",value:function(t){return this.events.indexOf(t)>-1}}]),t}();e.a=a},/*!***************************!*\
  !*** ./js/Util/Binary.js ***!
  \***************************/
function(t,e,i){"use strict";var n=i(/*! es6-promise */19),r=i.n(n),s={sendArrayBufferView:function(t,e){var i=new XMLHttpRequest;i.open("POST",e,!0),i.send(t)},getArrayBuffer:function(t){return new r.a(function(e,i){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){var t=n.response;t?e(t):i(!1)},n.send(null)})}};e.a=s},/*!*************************!*\
  !*** ./js/Util/Pool.js ***!
  \*************************/
function(t,e,i){"use strict";var n={create:function(t,e){t._pool=[],t._poolMarker=0,t._poolSize=0;var i=t._pool;t.createFromPool=function(){t._poolSize<=t._poolMarker&&t.expandPool(10);var e=t._pool[t._poolMarker++];return e._poolIndex=t._poolMarker-1,t.prototype.constructor.apply(e,arguments),e},t.expandPool=function(e){for(var n={pool:!0},r=i.length,s=i.length+e;r<s;r++)i.push(new t(n));t._poolSize+=e},t.prototype.freeFromPool=function(){t._poolMarker>0&&t._poolMarker--;var e=i[t._poolMarker],n=e._poolIndex;i[t._poolMarker]=this,i[this._poolIndex]=e,e._poolIndex=this._poolIndex,this._poolIndex=n},t.expandPool(e)}};e.a=n},/*!*******************************************!*\
  !*** ./~/es6-promise/dist/es6-promise.js ***!
  \*******************************************/
function(t,e,i){(function(e,n){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.1.0
 */
!function(e,i){t.exports=i()}(0,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function r(t){return"function"==typeof t}function s(t){q=t}function o(t){V=t}function a(){return void 0!==W?function(){W(l)}:u()}function u(){var t=setTimeout;return function(){return t(l,1)}}function l(){for(var t=0;t<X;t+=2){(0,Z[t])(Z[t+1]),Z[t]=void 0,Z[t+1]=void 0}X=0}function h(t,e){var i=arguments,n=this,r=new this.constructor(f);void 0===r[tt]&&j(r);var s=n._state;return s?function(){var t=i[s-1];V(function(){return P(s,r,t,n._result)})}():O(n,r,t,e),r}function c(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(f);return w(i,t),i}function f(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(t){return rt.error=t,rt}}function y(t,e,i,n){try{t.call(e,i,n)}catch(t){return t}}function m(t,e,i){V(function(t){var n=!1,r=y(i,e,function(i){n||(n=!0,e!==i?w(t,i):x(t,i))},function(e){n||(n=!0,_(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&r&&(n=!0,_(t,r))},t)}function g(t,e){e._state===it?x(t,e._result):e._state===nt?_(t,e._result):O(e,void 0,function(e){return w(t,e)},function(e){return _(t,e)})}function b(t,e,i){e.constructor===t.constructor&&i===h&&e.constructor.resolve===c?g(t,e):i===rt?(_(t,rt.error),rt.error=null):void 0===i?x(t,e):r(i)?m(t,e,i):x(t,e)}function w(e,i){e===i?_(e,p()):t(i)?b(e,i,v(i)):x(e,i)}function k(t){t._onerror&&t._onerror(t._result),T(t)}function x(t,e){t._state===et&&(t._result=e,t._state=it,0!==t._subscribers.length&&V(T,t))}function _(t,e){t._state===et&&(t._state=nt,t._result=e,V(k,t))}function O(t,e,i,n){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+it]=i,r[s+nt]=n,0===s&&t._state&&V(T,t)}function T(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,r=void 0,s=t._result,o=0;o<e.length;o+=3)n=e[o],r=e[o+i],n?P(i,n,r,s):r(s);t._subscribers.length=0}}function S(){this.error=null}function E(t,e){try{return t(e)}catch(t){return st.error=t,st}}function P(t,e,i,n){var s=r(i),o=void 0,a=void 0,u=void 0,l=void 0;if(s){if(o=E(i,n),o===st?(l=!0,a=o.error,o.error=null):u=!0,e===o)return void _(e,d())}else o=n,u=!0;e._state!==et||(s&&u?w(e,o):l?_(e,a):t===it?x(e,o):t===nt&&_(e,o))}function C(t,e){try{e(function(e){w(t,e)},function(e){_(t,e)})}catch(e){_(t,e)}}function M(){return ot++}function j(t){t[tt]=ot++,t._state=void 0,t._result=void 0,t._subscribers=[]}function F(t,e){this._instanceConstructor=t,this.promise=new t(f),this.promise[tt]||j(this.promise),H(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):_(this.promise,A())}function A(){return new Error("Array Methods must be provided an Array")}function R(t){return new F(this,t).promise}function L(t){var e=this;return new e(H(t)?function(i,n){for(var r=t.length,s=0;s<r;s++)e.resolve(t[s]).then(i,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function I(t){var e=this,i=new e(f);return _(i,t),i}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Y(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function B(t){this[tt]=M(),this._result=this._state=void 0,this._subscribers=[],f!==t&&("function"!=typeof t&&D(),this instanceof B?C(this,t):Y())}function N(){var t=void 0;if(void 0!==n)t=n;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=B}var G=void 0;G=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var H=G,X=0,W=void 0,q=void 0,V=function(t,e){Z[X]=t,Z[X+1]=e,2===(X+=2)&&(q?q(l):$())},U="undefined"!=typeof window?window:void 0,K=U||{},z=K.MutationObserver||K.WebKitMutationObserver,J="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),Q="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Z=new Array(1e3),$=void 0;$=J?function(){return function(){return e.nextTick(l)}}():z?function(){var t=0,e=new z(l),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():Q?function(){var t=new MessageChannel;return t.port1.onmessage=l,function(){return t.port2.postMessage(0)}}():void 0===U?function(){try{var t=i(/*! vertx */44);return W=t.runOnLoop||t.runOnContext,a()}catch(t){return u()}}():u();var tt=Math.random().toString(36).substring(16),et=void 0,it=1,nt=2,rt=new S,st=new S,ot=0;return F.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===et&&i<t;i++)this._eachEntry(e[i],i)},F.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===c){var r=v(t);if(r===h&&t._state!==et)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(i===B){var s=new i(f);b(s,t,r),this._willSettleAt(s,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},F.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===et&&(this._remaining--,t===nt?_(n,i):this._result[e]=i),0===this._remaining&&x(n,this._result)},F.prototype._willSettleAt=function(t,e){var i=this;O(t,void 0,function(t){return i._settledAt(it,e,t)},function(t){return i._settledAt(nt,e,t)})},B.all=R,B.race=L,B.resolve=c,B.reject=I,B._setScheduler=s,B._setAsap=o,B._asap=V,B.prototype={constructor:B,then:h,catch:function(t){return this.then(null,t)}},B.polyfill=N,B.Promise=B,B})}).call(e,i(/*! ./../../process/browser.js */41),i(/*! ./../../webpack/buildin/global.js */43))},/*!*****************************!*\
  !*** ./js/athena-module.js ***!
  \*****************************/
function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(/*! ./Game/Game */38);i.d(e,"Game",function(){return n.a});var r=i(/*! ./Util/Pool */18);i.d(e,"Pool",function(){return r.a});var s=i(/*! ./Scene/Scene */39);i.d(e,"Scene",function(){return s.a});var o=i(/*! ./Resource/ResourceManager */5);i.d(e,"ResourceManager",function(){return o.a});var a=i(/*! ./Drawable/Drawable */2);i.d(e,"Drawable",function(){return a.a});var u=i(/*! ./Drawable/Sprite */32);i.d(e,"Sprite",function(){return u.a});var l=i(/*! ./Drawable/SimpleText */13);i.d(e,"SimpleText",function(){return l.a});var h=i(/*! ./Drawable/Wave */14);i.d(e,"Wave",function(){return h.a});var c=i(/*! ./Drawable/Menu */30);i.d(e,"Menu",function(){return c.a});var f=i(/*! ./Drawable/Hud */29);i.d(e,"Hud",function(){return f.a});var p=i(/*! ./Drawable/BitmapText */28);i.d(e,"BitmapText",function(){return p.a});var d=i(/*! ./Drawable/Paint */31);i.d(e,"Paint",function(){return d.a});var v=i(/*! ./Drawable/Behavior/Behavior */1);i.d(e,"Behavior",function(){return v.a});var y=i(/*! ./Notification/NotificationManager */9);i.d(e,"NotificationManager",function(){return y.a});var m=i(/*! ./Map/Map */15);i.d(e,"Map",function(){return m.a});var g=i(/*! ./Map/Tile */4);i.d(e,"Tile",function(){return g.a});var b=i(/*! ./Map/MapEvent */16);i.d(e,"MapEvent",function(){return b.a});var w=i(/*! ./FX/FX */3);i.d(e,"FX",function(){return w.a});var k=i(/*! ./FX/Effect/Effect */8);i.d(e,"Effect",function(){return k.a});var x=i(/*! ./FX/Easing/Easing */33);i.d(e,"Easing",function(){return x.a});var _=i(/*! ./Input/InputManager */10);i.d(e,"InputManager",function(){return _.a});var O=i(/*! ./Display/DisplayManager */12);i.d(e,"DisplayManager",function(){return O.a});var T=i(/*! ./Display/Display */11);i.d(e,"Display",function(){return T.a});var S=i(/*! ./Audio/AudioManager */7);i.d(e,"AudioManager",function(){return S.a});var E=i(/*! ./Util/Binary */17);i.d(e,"Binary",function(){return E.a});var P=i(/*! ./Util/Dom */6);i.d(e,"Dom",function(){return P.a});var C=i(/*! ./Util/Deferred */0);i.d(e,"Deferred",function(){return C.a})},/*!*******************************************!*\
  !*** ./js/Drawable/Behavior/Behaviors.js ***!
  \*******************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ./GroundMove */22),s=i(/*! ./SimpleFall */26),o=i(/*! ./PlayerMove */25),a=i(/*! ./InOut */23),u=i(/*! ./Path */24),l=i(/*! ./WeaponMove */27),h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c={},f=function(){function t(){n(this,t)}return h(t,[{key:"addBehavior",value:function(t,e){c[t]=e}},{key:"getBehavior",value:function(t){return c[t]}}]),t}(),p=new f;p.addBehavior("ground",r.a),p.addBehavior("inout",a.a),p.addBehavior("simplefall",s.a),p.addBehavior("weapon",l.a),p.addBehavior("player",o.a),p.addBehavior("path",u.a),e.a=p},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/GroundMove.js ***!
  \********************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Map/Tile */4),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.direction=i.direction||"right",s.direction.match("left")&&(s.sprite.vx=-s.sprite.vx),s.direction.match("top")&&(s.sprite.vy=-s.sprite.vy),s}return s(e,t),u(e,[{key:"onUpdate",value:function(){var t=this.sprite,e=t.currentMap,i=t.x+t.vx,n=t.y+t.vy,r=t.getHitBox(),s=t.vx>0?r.x2:r.x;e.hitObjectTest(i+s,n+r.y,i+s,n+r.y,a.a.TYPE.WALL)?(t.vx=-t.vx,this.onVXChange&&this.onVXChange(t.vx)):e.hitObjectTest(i+r.x,n+r.y2+2,i+r.x2,n+r.y2+2,a.a.TYPE.AIR)?(t.vx=-t.vx,this.onVXChange&&this.onVXChange(t.vx)):e.hitObjectTest(i+r.x,n+r.y2+2,i+r.x2,n+r.y2+2,a.a.TYPE.LADDER)&&(t.vx=-t.vx,this.onVXChange&&this.onVXChange(t.vx)),t.x+=t.vx,t.y+=t.vy}}]),e}(o.a);e.a=l},/*!***************************************!*\
  !*** ./js/Drawable/Behavior/InOut.js ***!
  \***************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Behavior */1),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.startY=t.y,s.startX=t.x,s.maxX=i.minX||0,s.maxY=i.minY||0,s}return s(e,t),a(e,[{key:"onUpdate",value:function(){var t=this.sprite,e=Math.abs(t.y-this.startY),i=Math.abs(t.x-this.startX);e>this.maxY&&(t.vy=-t.vy,this.onVYChange&&this.onVYChange()),i>this.maxX&&(t.vx=-t.vx,this.onVXChange&&this.onVXChange()),t.x+=t.vx,t.y+=t.vy}}]),e}(o.a);e.a=u},/*!**************************************!*\
  !*** ./js/Drawable/Behavior/Path.js ***!
  \**************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t){return"number"==typeof t?t?t<0?-1:1:t===t?0:NaN:NaN}var a=i(/*! ./Behavior */1),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.startY=t.y,s.startX=t.x,s.currentNode=0,s.offset=2,s.nodes=i.nodes,s.reverse=i.reverse||!1,s.dirX=0,s.dirY=0,s.numNodes=s.nodes.length/2,s}return s(e,t),u(e,[{key:"onUpdate",value:function(){var t=this.sprite,e=this.currentNode,i=this.nodes[e],n=this.nodes[e+1];if(this.offset>0?(t.x+=i,t.y+=n):(t.x-=i,t.y-=n),i&&(this.dirX&&o(this.dirX)!==o(i)&&this.onVXChange&&this.onVXChange(),this.dirX=i),n&&(this.dirY&&o(this.dirY)!==o(n)&&this.onVYChange&&this.onVYChange(),this.dirY=n),this.currentNode+=this.offset,this.currentNode>=this.nodes.length||this.currentNode<0){if(!this.reverse)return void(t.movable=!1);this.onVXChange&&(this.dirX=0,this.onVXChange()),this.onVYChange&&(this.dirY=0,this.onVYChange()),this.currentNode=this.currentNode<0?0:this.nodes.length-2,this.offset=-this.offset}}}]),e}(a.a);e.a=l},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/PlayerMove.js ***!
  \********************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Audio/AudioManager */7),u=i(/*! ../../Map/Tile */4),l=i(/*! ../../Input/InputManager */10),h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.direction=i.direction||"right",s.currentMovement=i.startMovement||"",s.lookDirection=i.lookDirection||"left",s.climbVY=2,s.jumping=!1,s.firing=!1,s.fromLadder=!1,s.sideHit=!1,s}return s(e,t),h(e,[{key:"onUpdate",value:function(){if("falling"===this.currentMovement||this.currentMovement.match(/jump/)||this.firing)this.currentMovement.match(/jump/)?(l.a.isKeyDown("SPACE",!0)&&this.handleFire(),this.fromLadder||!0!==l.a.getKeyStatus(l.a.KEYS.UP)||this.goUpOrClimb(!0),this.jump()):this.currentMovement.match("fire")||this.currentMovement.match("climb")||this.fall();else if(l.a.isKeyDown("CTRL")?(console.log("[PlayerMove] jump:",this.lookDirection),this.startJump(this.lookDirection)):!0===l.a.getKeyStatus(l.a.KEYS.LEFT)?!0===l.a.getKeyStatus(l.a.KEYS.UP)?this.startJump("left"):this.walkLeft():!0===l.a.getKeyStatus(l.a.KEYS.RIGHT)?!0===l.a.getKeyStatus(l.a.KEYS.UP)?(this.startJump("right"),console.log("[PlayerMove] startJump right",this.fromLadder)):this.walkRight():!0===l.a.getKeyStatus(l.a.KEYS.UP)?this.goUpOrClimb(!1):!0===l.a.getKeyStatus(l.a.KEYS.DOWN)?this.goDownOrClimb():"climb"!==this.currentMovement?this.currentMovement.match("fire")||this.idle():this.stopClimbing(),l.a.isKeyDown("SPACE",!0))switch(this.currentMovement){case"faceWall":this.switchAbove&&this.getMapEvent().handleAction({type:"toggleSwitch",sprite:this.switchAbove});break;case"climb":if(!this.lookDirection)break;case"idle":case"walk_right":case"walk_left":this.handleFire();break;case"down":break;default:console.log("[PlayerMove] unhandle fire",this.currentMovement)}}},{key:"handleFire",value:function(){var t=this;console.log("[PlayerMove] fire direction",this.lookDirection),this.firing||this.sprite.onEvent("fire",{direction:this.lookDirection})&&(this.firing=!0,this.previousMovement=this.currentMovement,this.sprite.storeCurrentAnim(),this.sprite.setAnimation("fire"+this.lookDirection,function(){t.firing=!1,this.restorePreviousAnim()}))}},{key:"walk",value:function(t){var e=this.sprite,i=e.getHitBox(),n=void 0,r=void 0,s=void 0;return this.currentMovement="walk_"+t,this.vy=0,e.currentAnimName="walk"+t.charAt(0).toUpperCase()+t.slice(1),s="step_"+t,this.lookDirection=t,this.vx="left"===t?-2:2,n=e.x+this.vx,r=e.y+this.vy,e.currentMap.hitObjectTest(n+i.x,r+i.y,n+i.x2,r+i.y2,u.a.TYPE.WALL)?this.idle():(e.startAnimation(),e.currentFrameNum===e.previousFrameNum||3!==e.currentFrameNum&&7!==e.currentFrameNum||a.a.play(s)),e.x+=this.vx,e.y+=this.vy,this.fallTest(),0}},{key:"walkLeft",value:function(){"climb"!==this.currentMovement?this.walk("left"):this.lookDirection="left"}},{key:"walkRight",value:function(){"climb"!==this.currentMovement?this.walk("right"):this.lookDirection="right"}},{key:"startJump",value:function(t){var e=this.sprite,i=this;this.jumping?(i.readyToJump=!0,this.jumping=!0,i.currentMovement="jump"+t,this.vx="left"===t?-2:2,this.vy=-4,this.gravity=.098,this.sprite.setAnimation("jump"+t)):(console.log("[PlayerMove] starting jump",e.y),this.readyToJump=!1,this.currentMovement="startjump",this.vx="left"===t?-2:2,this.vy=-4,this.gravity=.098,console.log("[PlayerMove] startJump",this.vy),e.setAnimation("goDown"+t,function(){console.log("[PlayerMove] end goDownLeft, ready to jump",this.vy,this.y),i.readyToJump=!0,i.currentMovement="jump"+t,i.jumping=!0,this.setAnimation("jump"+t)})),this.lookDirection=this.direction=t,this.sideHit=!1,a.a.play("jump")}},{key:"jump",value:function(){var t=this.sprite,e=t.x+Math.ceil(this.vx),i=t.y+Math.ceil(this.vy),n=t.getHitBox(),r=null,s=null,o=!1;return this.readyToJump?this.currentMovement.match(/jump/)&&(r=t.currentMap.hitObjectTest(e+n.x,t.y+n.y,e+n.x2,t.y+n.y2,u.a.TYPE.WALL),r&&(this.sideHit=!0,o=!0,"right"===this.direction?t.x=r.tile.x-n.x2-n.x-1:t.x=r.tile.x+t.currentMap.tileWidth),s=t.currentMap.hitObjectTest(t.x+n.x,i+n.y,t.x+n.x2,i+n.y2,u.a.TYPE.WALL))?this.vy<0?(console.log("[PlayerMove] Top collision, reversing vy!"),void(this.sideHit?this.vy=-this.vy:this.fall())):(console.log("[PlayerMove] touch ground!",this.currentMovement),this.jumping=!1,this.fromLadder=!1,a.a.play("land"),this.currentMovement="idle",t.y=s.tile.y-t.getCurrentHeight(),void(this.vy=0)):(o||(t.x+=Math.ceil(this.vx)),t.y+=Math.ceil(this.vy),this.vy+=this.gravity,void 0):void console.log("[PlayerMove] not ready to jump",this.fromLadder)}},{key:"idle",value:function(){var t=this.sprite;this.vx=0,this.vy=0,t.stopAnimation()}},{key:"goDown",value:function(){var t=this.sprite;this.vx=0,this.vy=0,t.currentAnimName="goDown"+this.lookDirection,this.currentMovement=""}},{key:"faceWall",value:function(){var t=this.sprite;this.vx=0,this.vy=0,"faceWall"!==this.currentMovement&&(this.currentMovement="faceWall",t.advanceFrame("faceWall"),this.switchAbove=this.sprite.currentMap.getSwitchAboveMaster())}},{key:"climb",value:function(t){var e=this.sprite;this.fromLadder=!0,this.currentMovement="climb",this.vx=0,this.vy=t?-this.climbVY:this.climbVY,e.currentAnimName="climb",e.startAnimation(),e.x+=this.vx,e.y+=this.vy}},{key:"stopClimbing",value:function(){var t=this.sprite;this.vx=0,this.vy=0,t.stopAnimation()}},{key:"goUpOrClimb",value:function(t){var e=this.sprite,i=e.getHitBox(),n=t?0:24,r=!1;return!0!==l.a.getKeyStatus(l.a.KEYS.LEFT)&&!0!==l.a.getKeyStatus(l.a.KEYS.RIGHT)&&(!0===t?e.currentMap.hitObjectTest(i.x+e.x,i.y+e.y+40,i.x+e.x-n,i.y2+e.y-50,u.a.TYPE.LADDER)&&(r=e.currentMap.hitObjectTest(i.x2+e.x+n,i.y+e.y+40,i.x2+e.x-n,i.y2+e.y-50,u.a.TYPE.LADDER)):r=e.currentMap.hitObjectTest(i.x+e.x+n,i.y+e.y+40,i.x2+e.x-n,i.y2+e.y-50,u.a.TYPE.LADDER),!1!==r?("climb"!==this.currentMovement&&(e.centerXOverTile(r),this.lookDirection=""),this.climb(1),!0):t?void 0:(this.faceWall(),!1))}},{key:"goDownOrClimb",value:function(){var t=this.sprite,e=t.getHitBox(),i=t.currentMap.hitObjectTest(e.x+t.x+24,e.y2+t.y+this.climbVY,e.x2+t.x-24,e.y2+t.y+this.climbVY,u.a.TYPE.LADDER);i?("climb"!==this.currentMovement&&t.centerXOverTile(i),this.climb(0)):"climb"===this.currentMovement||"faceWall"===this.currentMovement?(i=t.currentMap.hitObjectTest(e.x+t.x+24,e.y2+t.y+this.climbVY,e.x2+t.x-24,e.y2+t.y+this.climbVY,u.a.TYPE.LADDER),this.faceWall()):this.goDown()}},{key:"fall",value:function(){var t=4,e=this.sprite;for(this.jumping=!1;t>0;t--)if(this.fallTest(t)){this.vy=t;break}t>0?(this.vx=0,e.y+=this.vy,e.advanceFrame("fall"+this.lookDirection)):this.fromLadder=!1}},{key:"fallTest",value:function(t){t=t||1;var e=this.sprite,i=e.getHitBox(),n=e.y+i.y2+t;return e.currentMap.fallTest(e.x+i.x,n)||e.currentMap.fallTest(e.x+i.x2,n)?("falling"==this.currentMovement&&(this.currentMovement=""),!1):(this.currentMovement="falling",!0)}}]),e}(o.a);e.a=c},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/SimpleFall.js ***!
  \********************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Map/Tile */4),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.elasticity=void 0!==i.elasticity?i.elasticity:.8,s.onEnd=i.onEnd||null,s.onGround=i.onGround||null,s}return s(e,t),u(e,[{key:"onUpdate",value:function(){var t=this.sprite,e=t.currentMap,i=t.x+t.vx,n=t.y+t.vy,r=t.getHitBox(),s=null;s=e.hitObjectTest(i+r.x,n+r.y2,i+r.x2,n+r.y2,a.a.TYPE.WALL),s?(this.onGround&&this.onGround(),this.resetY(),Math.abs(t.vy)<=t.gravity&&(t.movable=!1,this.onEnd&&this.onEnd())):(t.vy+=t.gravity,t.y+=t.vy)}},{key:"resetY",value:function(){this.sprite.vy=-this.sprite.vy*this.elasticity}}]),e}(o.a);e.a=l},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/WeaponMove.js ***!
  \********************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Map/Tile */4),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.direction=i.direction||"right",s.direction.match("left")&&(t.vx=-t.vx),s.direction.match("top")&&(t.vy=-t.vy),s}return s(e,t),u(e,[{key:"onUpdate",value:function(){var t=this.sprite,e=t.currentMap,i=t.x+t.vx,n=t.y+t.vy,r=t.getHitBox(),s=t.vx>0?r.x2:r.x;e.hitObjectTest(i+s,n+r.y,i+s,n+r.y2,a.a.TYPE.WALL)&&(t.vx=-t.vx,this.onVXChange&&this.onVXChange(t.vx)),t.x+=t.vx,t.y+=t.vy}}]),e}(o.a);e.a=l},/*!***********************************!*\
  !*** ./js/Drawable/BitmapText.js ***!
  \***********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Drawable */2),a=i(/*! ../FX/FX */3),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},h=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BitmapText",i=arguments[1];n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.width=i.width||320,s.height=i.height||18,s.pixelHeight=0,s.easing=a.a.getEasing(i.easing||"linear"),s.imageId=i.imageId||"image not set",s.characters=i.characters||"ABCDEFGHIJKLMNOPQRSTUVWXYZ",i.imageSrc&&(s.imageId=i.imageSrc),s.buffer=null,s.image=null,s.scrolling=!1,s.text=i.text||"BitmapText",s.scrollOffsetX=i.scrollOffsetX||0,s.scrollOffsetY=i.scrollOffsetY||0,s.textArray=[],s.setFontParams(i),s}return s(e,t),u(e,[{key:"createBuffer",value:function(t){var e=this.width,i=this.height;this.buffer=t.getBuffer(e,i)}},{key:"clearBuffer",value:function(){this.currentScene.display.clearScreen(this.buffer)}},{key:"setFontParams",value:function(t){this.lineSpacing=t.lineSpacing||2,this.letterSpacing=t.letterSpacing||2,this.charWidth=t.charWidth||16,this.charHeight=t.charHeight||18,this.maxCharPerLine=Math.floor(this.width/(this.charWidth+this.letterSpacing)),this.maxPixels=this.maxCharPerLine*(this.charWidth+this.letterSpacing),this.offsetX=t.offsetX||this.charWidth,this.startX=t.startX||0,this.startY=t.startY||0}},{key:"_reset",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.setTextPosition()}},{key:"getNextLineLength",value:function(t,e){for(var i=0;i<t.length&&t[i]!==e;)i++;return i}},{key:"getLines",value:function(){var t=this.text,e="",i=!1,n=0,r=0;for(this.textArray.length=0;!i;)t=t.replace(/^\n/,""),n=this.getNextLineLength(t,"\n"),n?(e=t.substr(0,n),e.length<=this.maxCharPerLine?t=t.substr(n):(e=t.substr(0,this.maxCharPerLine),t=t.substr(this.maxCharPerLine)),this.textArray.push({text:e,x:"center"===this.align?Math.floor((this.maxPixels-e.length*(this.charWidth+this.letterSpacing))/2):0,y:r}),r+=this.charHeight+this.lineSpacing):i=!0;this.pixelHeight=this.textArray.length*(this.charHeight+this.lineSpacing)}},{key:"scrollFromBottom",value:function(t,e){this.scrollOffsetY=this.height,this.scrollText({callback:e,duration:t,targetOffsetX:0,targetOffsetY:this.height-this.pixelHeight})}},{key:"scrollFromTop",value:function(t,e){this.scrollOffsetY=-this.pixelHeight,this.scrollText({callback:e,duration:t,targetOffsetX:0,targetOffsetY:0})}},{key:"scrollText",value:function(t){this.scrolling||(console.log("starting scrolling"),this.scrolling=!0,this.callback=t.callback&&t.callback.bind(this)||null,this.duration=t.duration||1e4,this.targetOffsetX=t.targetOffsetX,this.targetOffsetY=t.targetOffsetY,this.startX=this.scrollOffsetX,this.startY=this.scrollOffsetY,this.speedX=this.targetOffsetX-this.startX|0,this.speedY=this.targetOffsetY-this.startY|0,this.startMoveTime=(new Date).getTime())}},{key:"setTextPosition",value:function(){}},{key:"update",value:function(){var t=(new Date).getTime(),e=t-this.startMoveTime,i=e/this.duration,n=void 0;!0===this.scrolling&&(e>=this.duration?(this.scrolling=!1,this.scrollOffsetX=this.targetOffsetX,this.scrollOffsetY=this.targetOffsetY,this.callback&&this.callback()):(n=this.easing(i,e,0,1,this.duration),this.scrollOffsetX=this.startX+n*this.speedX|0,this.scrollOffsetY=this.startY+n*this.speedY|0))}},{key:"getCharOffset",value:function(t){var e=this.characters.indexOf(t);return e<0&&(e=this.characters.indexOf(t.toUpperCase())),e*this.offsetX}},{key:"drawLine",value:function(t){var e=t.x,i=t.y,n=0,r=0,s=t.text.length;for(n=0;n<s;++n)32!==t.text[n].charCodeAt(0)&&(r=this.getCharOffset(t.text[n]),r>=0?this.buffer.drawImage(this.image,r,this.startY,this.charWidth,this.charHeight,e,i,this.charWidth,this.charHeight):console.log("[BitmapText] character "+t.text[n]+" not supported")),e+=this.letterSpacing+this.charWidth}},{key:"renderText",value:function(){var t=0,e=0,i=void 0;for(e=this.textArray.length,t=0;t<e;++t)i=this.textArray[t],this.drawLine(i)}},{key:"setText",value:function(t){this.text=t,this.getLines(),this.buffer?this.clearBuffer():this.createBuffer(this.currentScene.display),this.renderText()}},{key:"setImage",value:function(t){if(!t)return void console.warn("[BitmapText] setImage(): image not loaded",this.imageId||this.imageSrc);this.image=t}},{key:"setScene",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setScene",this).call(this,t),this.setText(this.text)}},{key:"draw",value:function(t){var e,i,n=this.width*this.scale,r=this.height*this.scale,s=Math.floor(n/2),o=Math.floor(r/2),a=this.currentMap&&this.currentMap.viewportX||0,u=this.currentMap&&this.currentMap.viewportY||0,l=this.width,h=this.height;this.visible&&this.image&&(this.executeFx(t),this.scrollOffsetY>=0?(e=this.scrollOffsetY,this.height-e,i=0):(e=0,h,i=Math.abs(this.scrollOffsetY)),t.setTransform(this.scale,0,0,this.scale,this.x+a+s,this.y+u+o),t.rotate(this.angle),t.drawImage(this.buffer.canvas,0,i,Math.floor(l),Math.floor(h),Math.floor(-s),Math.floor(-o),Math.floor(n),Math.floor(r)))}}]),e}(o.a);e.a=h},/*!****************************!*\
  !*** ./js/Drawable/Hud.js ***!
  \****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e){n(this,t),this.score=e.score||0,this.alternateScore=e.alternateScore||0,this.energy=e.energy||100,this.$dest=e.target,this.info="",this.inventory={},this.width=e.width||1024,this.height=e.height||64,Object.defineProperty(this,"score",{get:function(){return this.score},set:function(t){this.score=t}})}return r(t,[{key:"drawBackground",value:function(){}},{key:"draw",value:function(){this.drawBackground()}}]),t}();e.a=s},/*!*****************************!*\
  !*** ./js/Drawable/Menu.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Drawable */2),a=i(/*! ./SimpleText */13),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.title=new a.a(t,{color:i.color||"black",text:i.title||"Menu Title"}),s.color=i.color||"white",s.selectedColor=i.selectedColor||"red",s.menuItems=[],s.selectedItem=i.selectedItem||0,s.selectCallbacks=[],s.hoverCallbacks=[],s.itemHeight=i.itemHeight||40,s.title.moveTo(s.x,s.y),s.addMenuItems(i.menuItems||[]),s}return s(e,t),u(e,[{key:"addMenuItem",value:function(t){var e=this.y+(this.menuItems.length+1)*this.itemHeight,i=new a.a("menuItem"+this.menuItems.length,t);i.moveTo(this.x,e),i.visible=!0===t.visible||!1,i.selectable=!0===t.selectable||!1,this.menuItems.push(i)}},{key:"addMenuItems",value:function(t){var e=this;console.log("[Menu] addMenuItems()",t),t.forEach(function(t,i){e.addMenuItem(t),t.active&&(e.selectedItem=i)})}},{key:"nextItem",value:function(){++this.selectedItem>=this.menuItems.length&&(this.selectedItem=0),this.selectedItem&&this.menuItems[this.selectedItem]&&!this.menuItems[this.selectedItem].selectable&&this.nextItem()}},{key:"getSelectedItemIndex",value:function(){return this.selectedItem}},{key:"getSelectedItem",value:function(){return this.menuItems[this.selectedItem]}},{key:"setText",value:function(t,e){this.menuItems[t]=e}},{key:"draw",value:function(t){var e=this;0!==this.angle&&(t.save(),t.rotate(this.angle)),this.title.draw(t),this.menuItems.forEach(function(i,n){n===e.selectedItem?i.color=e.selectedColor||"blue":i.color=e.color,i.draw(t)}),0!==this.angle&&t.restore()}}]),e}(o.a);e.a=l},/*!******************************!*\
  !*** ./js/Drawable/Paint.js ***!
  \******************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Drawable */2),a=i(/*! ../Util/Deferred */0),u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},h=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.width=i.width||0,s.height=i.height||0,s.x=i.x||0,s.y=i.y||0,s.color=i.color||"red",s}return s(e,t),u(e,[{key:"draw",value:function(t){this.ctx=t,t.setTransform(1,0,0,1,0,0),this._applyMask(t,this.x,this.y),this.isFxQueueEmpty()||this.executeFx(t),this.render(),this._undoMask()}},{key:"render",value:function(){}},{key:"fill",value:function(t){this.ctx.fillStyle=t||this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height)}},{key:"rect",value:function(t,e,i,n,r){var s=this.ctx;s.fillStyle=r||this.color,s.fillRect(this.x+t,this.y+e,i,n)}},{key:"circle",value:function(t,e,i,n,r,s){var o=this.ctx;o.beginPath(),o.arc(this.x+t+i,this.y+e+i,i,0,2*Math.PI,!1),o.fillStyle=n||this.color,o.fill(),arguments.length>4&&(o.strokeStyle=s||this.color,o.lineWidth=r,o.stroke())}},{key:"arc",value:function(t,e,i,n,r,s,o){var a=this.ctx;a.beginPath(),a.arc(this.x+t,this.y+e,i,n,r,!1),a.lineWidth=o,a.strokeStyle=s||this.color,a.stroke()}},{key:"animate",value:function(t,i){return"Fade"!==t?(console.warn("animte() not supported on Canvas objects yet. Effect not applied."),a.a.resolve(!0)):l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"animate",this).call(this,t,i)}}]),e}(o.a);window.Canvas=h,e.a=h},/*!*******************************!*\
  !*** ./js/Drawable/Sprite.js ***!
  \*******************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Drawable */2),a=i(/*! ../Util/Deferred */0),u=i(/*! ../Util/Dom */6),l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},c=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t||"Sprite",i||{}));return s.imageId=i&&i.imageId||null,i&&i.animations&&s.load(i.animations),s}return s(e,t),l(e,[{key:"initProperties",value:function(){this.animations={},this.currentAnim=null,this.currentFrame=null,this.currentFrameNum=this.previousFrameNum=0,this.loaded=!1,this.currentAnimName="",this.storedAnimName="",this.storedFrameNum=0,this.numFrames=0,this.rewindOnEnd=!1,this.direction=1,this.frameCounter=0,this.animEndDef=null,this.animChangeDef=null,this.rewinded=!1,this.isDebug=!1}},{key:"debug",value:function(t){this.isDebug=t}},{key:"addAnimation",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};if(n[t]=Object.assign({frameDuration:1,loop:1,frames:[]},i),!i.frameWidth||!i.frameHeight||!i.numFrames)return void console.error("Parameter missing: frameWidth, frameHeight, numFrames are all required!");this.imageId=e;for(var r=i.offsetX||0,s=i.offsetY||0,o=0,a=i.numFrames||0,u=n[t].frames,l=i.frameHeight,h=i.frameWidth+(i.frameSpacing||0);o<a;)u.push({offsetX:r,offsetY:s,width:i.frameWidth,height:l,hitBox:{x:0,y:0,x2:i.frameWidth-1,y2:l-1}}),r+=h,o++;a&&this.load(n)}},{key:"load",value:function(t){var e=this,i=t||this._settings.animations,n=void 0;this.loaded||this.initProperties(),Object.keys(i).forEach(function(t){var r=i[t];e.animations[t]=r,n=t,r.flipFrom&&e.updateFlipAnimation(r,r.flipFrom,r.flipType)}),this.loaded||(this.loaded=!0,this.setAnimation(n))}},{key:"updateFlipAnimation",value:function(t,e,i){var n=this.animations[e].frames;t.frames=new Array(n.length);for(var r=0;r<n.length;++r)t.frames[r]={},Object.assign(t.frames[r],n[r]),1&i&&(t.frames[r].hitBox.x=n[r].width-n[r].hitBox.x2,t.frames[r].hitBox.x2=n[r].width-n[r].hitBox.x),2&i&&(t.frames[r].hitBox.y=n[r].height-n[r].hitBox.y2,t.frames[r].hitBox.y2=n[r].height-n[r].hitBox.y)}},{key:"setImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return void console.warn("[Sprite] setImage(): image not loaded",this.imageId||this.imageSrc);this.image&&!e||(this.image=t,this.children.forEach(function(e){e.setImage(t)}))}},{key:"rewind",value:function(){this.direction=-this.direction,this.running=!0,this.rewinded=!0,this.nextFrame(),console.log("[Sprite] rewind",this.currentFrameNum,this.running,this.rewinded,this.direction)}},{key:"nextFrame",value:function(){if(this.running)if(this.currentFrameNum+=this.direction,this.currentFrameNum<0||this.currentFrameNum>=this.numFrames)switch(this.currentAnim.loop){case 2:this.direction=-this.direction,this.currentFrameNum=this.currentFrameNum<0?0:this.numFrames-1,this.currentFrame=this.currentAnim.frames[this.currentFrameNum];break;case 1:this.currentFrameNum=this.currentAnim.loopFrom?this.currentAnim.loopFrom:0,this.currentFrame=this.currentAnim.frames[this.currentFrameNum];break;default:!this.currentAnim.rewindOnEnd||this.rewinded?(this.currentFrameNum-=this.direction,this.running=!1,this._animationEnded()):this.currentAnim.rewindOnEnd&&this.rewind()}else this.currentFrame=this.currentAnim.frames[this.currentFrameNum]}},{key:"storeCurrentAnim",value:function(){this.storedAnimName=this.currentAnimName,this.storedFrameNum=this.currentFrameNum}},{key:"restorePreviousAnim",value:function(){this.setAnimation(this.storedAnimName,null,this.storedFrameNum)}},{key:"advanceFrame",value:function(t){this.previousFrameNum=this.currentFrameNum,this.currentAnim!==this.animations[t]?(this.frameCounter=0,this.setAnimation(t)):++this.frameCounter>this.currentAnim.frameDuration&&(this.nextFrame(),this.frameCounter=0)}},{key:"getCurrentWidth",value:function(){return this.currentFrame.width}},{key:"getCurrentHeight",value:function(){return this.currentFrame.height}},{key:"getCurrentOffsetX",value:function(){return this.currentFrame.offsetX}},{key:"getCurrentOffsetY",value:function(){return this.currentFrame.offsetY}},{key:"getCurrentShiftX",value:function(){return this.currentFrame.shiftX||0}},{key:"getCurrentShiftY",value:function(){return this.currentFrame.shiftY||0}},{key:"getHitBox",value:function(){return this.currentFrame.hitBox||{x:0,y:0,x2:this.getCurrentWidth()-1,y2:this.getCurrentHeight()-1}}},{key:"getHitBox2",value:function(){var t=this.currentFrame.hitBox;return{x:this.x+t.x,x2:this.x+t.x2,y:this.y+t.y,y2:this.y+t.y2}}},{key:"centerXOverTile",value:function(t){var e=this.currentMap.tileWidth,i=this.getCurrentWidth(),n=Math.floor((e-i)/2);i<=e&&(this.x=t.x*e+n)}},{key:"clearMove",value:function(){this.running=!1}},{key:"setAnimation",value:function(t,e,i,n){this.loaded||this.load();try{this.currentAnim&&this._animationEnded(),this.animEndDef=new a.a,this.currentAnim&&this._animationChanged(this.currentAnimName,t),this.animChangeDef=new a.a,this.currentAnim=this.animations[t],this.currentAnimName=t,this.numFrames=this.currentAnim.frames.length,this.currentFrameNum=this.previousFrameNum=n?this.numFrames-1:i||0,this.currentFrame=this.currentAnim.frames[this.currentFrameNum],this.running=!0,this.rewinded=!1,this.direction=n?-1:1,"function"==typeof e&&this.onAnimationEnd(e)}catch(e){console.error("[Sprite] setAnimation() - unable to set animation ",t,"("+e.message+")","for sprite",this.id)}}},{key:"stopAnimation",value:function(t){this.running=!1,this.animEndDef&&!t&&this.animEndDef.reject()}},{key:"startAnimation",value:function(){this.running=!0}},{key:"onAnimationEnd",value:function(t){this.animEndDef.promise.then(t.bind(this))}},{key:"onAnimationChange",value:function(t){this.animChangeDef.promise.then(t.bind(this))}},{key:"_animationEnded",value:function(){this.animEndDef.resolve(this.currentAnimName,this.currentFrameNum)}},{key:"_animationChanged",value:function(t,e){this.animChangeDef.resolve(t,e)}},{key:"onHit",value:function(t){h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onHit",this).call(this,t),console.log("[Sprite] oops, ",this.type," [",this.id,"] ","was hit by",t.name," [",t.id,"]")}},{key:"draw",value:function(t){if(this.visible&&this.image&&this.currentAnimName){this.currentAnimName.length&&this.advanceFrame(this.currentAnimName);var e=this.getCurrentWidth(),i=e*this.scale,n=this.getCurrentHeight(),r=n*this.scale,s=Math.floor(i/2),o=Math.floor(r/2),a=this.getCurrentOffsetX(),u=this.getCurrentOffsetY(),l=this.currentAnim.flipFrom?this.x+this.getCurrentShiftX()-i:this.x+this.getCurrentShiftX(),h=this.currentAnim.flipFrom?this.y+this.getCurrentShiftY()-r:this.y+this.getCurrentShiftY(),c=this.currentMap&&this.currentMap.viewportX||0,f=this.currentMap&&this.currentMap.viewportY||0;e&&n&&(this.executeFx(t),this.mask&&!this.mask.exclude&&this._applyMask(t,Math.floor(l+c),Math.floor(h+f)),t.setTransform(this.scale,0,0,this.scale,l+c+s,h+f+o),t.rotate(this.angle),t.drawImage(this.image,Math.floor(a),Math.floor(u),Math.floor(e),Math.floor(n),Math.floor(-s),Math.floor(-o),Math.floor(i),Math.floor(r)),this.mask&&this.mask.exclude&&(t.setTransform(1,0,0,1,0,0),this._applyMask(t,Math.floor(l+c),Math.floor(h+f))),this._undoMask(t))}}},{key:"describeAllAnimations",value:function(){var t=this,e=null,n=this,r=1,s=1,o=0,a=0,l=0,h=0,c=void 0,f=null;Object.keys(this.animations).forEach(function(i){e=t.animations[i],o=e.frames[0].width,a=e.frames[0].height,(o+5)*e.frames.length>l&&(l=(o+5)*e.frames.length),h+=a+5}),c=document.getElementById("describe"),c||(c=document.createElement("canvas"),c.id="describe",c.setAttribute("width",l.toString()),c.setAttribute("height",h.toString())),f=i.i(u.a)("#describe")[0]&&i.i(u.a)("#describe")[0].getContext("2d")||new u.a("canvas").attr("id","describe").attr("width",l).attr("height",h).css("zIndex","100").appendTo("body")[0].getContext("2d"),f.webkitImageSmoothingEnabled=!1,Object.keys(this.animations).forEach(function(i){r=1,e=t.animations[i],console.log(i,"got",e.frames.length),console.log("frameDuration=",e.frameDuration),console.log("loop=",e.loop),console.log("loopFrom=",e.loopFrom),console.log("rewindOnEnd",e.rewindOnEnd),e.frames.forEach(function(t){var e=t.width,i=t.height,a=t.offsetX,u=t.offsetY,l=t.hitBox;f.drawImage(n.image,a,u,e,i,r,s,e,i),f.strokeStyle="rgb(240,240,240)",f.beginPath(),f.moveTo(r-1,s-1),f.lineTo(r+e,s-1),f.lineTo(r+e,s+i+1),f.lineTo(r-1,s+i+1),f.lineTo(r-1,s-1),f.closePath(),f.lineCap="butt",f.stroke(),l&&(f.strokeStyle="rgb(0,230,0)",f.beginPath(),f.moveTo(r+l.x,s+l.y),f.lineTo(r+l.x2,s+l.y),f.lineTo(r+l.x2,s+l.y2),f.lineTo(r+l.x,s+l.y2),f.lineTo(r+l.x,s+l.y),f.closePath(),f.stroke()),r+=o+5}),s+=a+5})}},{key:"listAnimations",value:function(){return this.animations}}]),e}(o.a);e.a=c},/*!********************************!*\
  !*** ./js/FX/Easing/Easing.js ***!
  \********************************/
function(t,e,i){"use strict";var n=i(/*! ../FX */3),r={easeInQuad:function(t,e,i,n,r){return n*(e/=r)*e+i},easeOutBounce:function(t,e,i,n,r){return(e/=r)<1/2.75?n*(7.5625*e*e)+i:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+i:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+i:n*(7.5625*(e-=2.625/2.75)*e+.984375)+i},swing:function(t){return.5-Math.cos(t*Math.PI)/2}};Object.keys(r).forEach(function(t){return n.a.addEasing(t,r[t])}),e.a=r},/*!********************************!*\
  !*** ./js/FX/Effect/Custom.js ***!
  \********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Effect */8),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.callback=t.callback,s.diff=s.endValue-s.startValue,s}return s(e,t),a(e,[{key:"process",value:function(t,i){return u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this),this.callback(this.startValue+this.animProgress*this.diff,t,i),this.ended}}]),e}(o.a);e.a=l},/*!******************************!*\
  !*** ./js/FX/Effect/Fade.js ***!
  \******************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Effect */8),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({startValue:0,endValue:1},t),i));return s.startOpacity=void 0!==s.startValue?t.startValue:0,s.endOpacity=void 0!==s.endValue?t.endValue:1,s.diff=s.endValue-s.startValue,s}return s(e,t),a(e,[{key:"start",value:function(){return this.currentOpacity=1,u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this).call(this)}},{key:"process",value:function(t,i,n){return u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this),this.currentOpacity=this.startValue+this.animProgress*this.diff,n.setOpacity(this.currentOpacity),this.ended}}]),e}(o.a);e.a=l},/*!********************************!*\
  !*** ./js/FX/Effect/Mosaic.js ***!
  \********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Effect */8),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({startValue:.002,endValue:1},t),i));return s.buffer=i.getBuffer(s.width,s.height),s.startWidth=null,s.ratio=s.width/s.height,s.diff=s.endValue*s.width-s.startValue*s.width,s}return s(e,t),a(e,[{key:"start",value:function(){return this.startWidth=this.startValue*this.width,u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this).call(this)}},{key:"process",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this);var i=this.startWidth+this.animProgress*this.diff,n=i/this.ratio;return this.buffer.drawImage(t.canvas,0,0,0|i,0|n),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(this.buffer.canvas,0,0,0|i,0|n,0,0,this.width,this.height),this.ended}}]),e}(o.a);e.a=l},/*!********************************!*\
  !*** ./js/FX/Effect/Rotate.js ***!
  \********************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=i(/*! ./Effect */8),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},l=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({startValue:0,endValue:2*Math.PI,loop:!0},t),i));return s.startAngle=void 0!==s.startAngle?t.startValue:0,s.endAngle=void 0!==s.endAngle?t.endValue:1,s.diff=s.endValue-s.startValue,s}return s(e,t),a(e,[{key:"start",value:function(){return this.currentAngle=this.startAngle,u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"start",this).call(this)}},{key:"stop",value:function(t,i){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"stop",this).call(this),t.setAngle(i)}},{key:"process",value:function(t,i,n){return u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this),this.currentAngle=this.startValue+this.animProgress*this.diff,n.setAngle(this.currentAngle),this.ended}}]),e}(o.a);e.a=l},/*!*************************!*\
  !*** ./js/Game/Game.js ***!
  \*************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../Resource/ResourceManager */5),s=i(/*! ../Display/DisplayManager */12),o=i(/*! ../Audio/AudioManager */7),a=i(/*! ../Notification/NotificationManager */9),u=i(/*! ../Input/InputManager */10),l=i(/*! ../lib/fpscounter/fpscounter.min */40),h=i.n(l),c=i(/*! ../Util/Dom */6),f=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),p=function(){function t(){var e=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t),console.log("[Game] Init()"),this.debug=s.debug,this.name=s.name;var o=s.target&&new c.a(s.target);this.showFps=void 0!==s.showFps&&s.showFps,this.showFps&&h()({width:50,height:50}),this.width=s.width||1024,this.height=s.height||768,this.target=o&&o.length&&o[0]||i.i(c.a)("div").css({width:this.width+"px",height:this.height+"px"}).appendTo("body")[0],i.i(c.a)(this.target).addClass("athena-game"),this.resources=s.resources,this.display=null,this.scene=null,this.running=!1,this._initEvents(),this.createDisplay({name:"main",width:s.width,height:s.height,layers:s.layers||[!1,!0]},this.target),this.toggleSound(void 0===s.sound||s.sound),this.sound||(console.warn("sound disabled: skipping audio resources"),r.a.skipResources.push("audio")),this.timeout=null,this.animFrame=null,this.bindEvents("*"),s.scene&&this.setScene(s.scene),this.debug&&(document.addEventListener("keyup",function(t){68===t.keyCode?e.scene&&(e.scene.debug(),e.scene.map&&e.toggleTileInspector(e.scene.isDebug)):70===t.keyCode?e.toggleFullscreen():80===t.keyCode&&e.togglePause()}),navigator.userAgent.match(/Xbox/)&&this.target.addEventListener("click",function(){console.log("[Game] Toggling fullscreen."),e.toggleFullscreen()}))}return f(t,[{key:"addInspector",value:function(){var t=this;this.moveHandler=function(e){var i=t.scene.map,n=e.offsetX>0?e.offsetX:0,r=e.offsetY>0?e.offsetY:0,s=t.scene.mapOffsetX,o=t.scene.mapOffsetY,a=i.viewportW,u=i.viewportH;if(e.offsetX<s||e.offsetX>s+a||e.offsetY<o||e.offsetY>o+u)t.tileInspector.hide(),t.tileHover.hide();else{var l=i.getTileIndexFromPixel(n-s-i.viewportX,r-o-i.viewportY);l?(t.tileInspector.html(l.x+", "+l.y+"<br />["+i.map[l.x+l.y*i.numCols]+", "+i.tileBehaviors[l.x+l.y*i.numCols]+"]").css({left:0,top:0}),t.tileInspector.show(),t.tileHover.css({left:l.x*i.tileWidth+s+i.viewportX+"px",top:l.y*i.tileHeight+o+i.viewportY+"px"}).show()):(t.tileInspector.hide(),t.tileHover.hide())}},this.tileInspector=new c.a("div").css({border:"1px dotted white","background-color":"rgba(0,0,0,.7)",color:"white","z-index":10,position:"absolute","pointer-events":"none"}).appendTo(this.target),this.tileHover=new c.a("div").css({border:"1px dotted white",width:this.scene.map.tileWidth+"px",height:this.scene.map.tileHeight+"px","background-color":"rgba(255,0,0,.4)",position:"absolute","z-index":10,top:0,left:0,"pointer-events":"none"}).appendTo(this.target),i.i(c.a)(this.target).css("position","relative")}},{key:"toggleTileInspector",value:function(t){t?(this.tileInspector||this.addInspector(),this.tileInspector.show(),this.target.addEventListener("mousemove",this.moveHandler,!1)):this.tileInspector&&(this.target.removeEventListener("mousemove",this.moveHandler),this.tileInspector.hide(),this.tileHover.hide())}},{key:"bindEvents",value:function(t){a.a.listen(t,this.onEvent.bind(this))}},{key:"onEvent",value:function(t){}},{key:"toggleSound",value:function(t){this.sound=t,o.a.toggleSound(t)}},{key:"toggleFullscreen",value:function(){this.display&&this.display.toggleFullscreen()}},{key:"createDisplay",value:function(t,e){this.display=s.a.addDisplay(t,e)}},{key:"_initEvents",value:function(){u.a.init(),this._addVisibilityEvents()}},{key:"_addVisibilityEvents",value:function(){var t=this,e="",i="";console.log("[Game] adding visibility events"),void 0!==document.hidden?(i="hidden",e="visibilitychange"):void 0!==document.msHidden?(i="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(i="webkitHidden",e="webkitvisibilitychange"),e.length?document.addEventListener(e,function(){console.log("[Game] got visibility event "+document[i]),document[i]&&t.running&&t.togglePause()},!1):console.warn("[Game] Visibility API not available.")}},{key:"setScene",value:function(t){console.log("[Game] setScene: "+t.name),this.scene!==t&&(this.scene&&(this._stopSceneLoops(),this.scene._stop(),this.toggleTileInspector(!1)),t?this._setupScene(t):console.warn("[Game] Attempt to set non-existing scene:",t))}},{key:"_startScene",value:function(){var t=this.scene.hudScene;this.display.clearAllScreens(),this.scene._start(),this.scene.start(),t&&t.start(),this._runSceneLoop(),this._renderSceneLoop()}},{key:"_setupScene",value:function(t){var e=this;this.scene=t;var i=t.hudScene;window.currentScene=t,this.scene.setDisplay(this.display),this.display.clearDisplay(),this.scene._setup(),this.scene.setup(),i&&i.setup(),this.scene._load().then(function(t){e.scene===t?e._startScene():console.warn("[Game] scene",t,"has finished loading but is not the current scene anymore so it won't be started.")}).catch(function(t){console.error(t)})}},{key:"_renderSceneLoop",value:function(){var t=this.scene;this.running&&(u.a.playingEvents&&u.a.nextRecordedEvents(),this.animFrame=window.requestAnimationFrame(this._renderSceneLoop.bind(this)),this.display.renderScene(t),t.hudScene,u.a.recording&&u.a.recordEvents())}},{key:"_runSceneLoop",value:function(){var t=this.scene;this.running||(this.running=!0),t.update((new Date).getTime()),this.running&&(this.timeout=setTimeout(this._runSceneLoop.bind(this),16))}},{key:"togglePause",value:function(){this.running?(this.running=!1,this.scene.pause(this.running),this.display.renderScene(this.scene),this._stopSceneLoops()):(this.running=!0,this.scene.pause(this.running),this._runSceneLoop(),this._renderSceneLoop())}},{key:"_stopSceneLoops",value:function(){this.running=!1,console.log("[Game] Scene stopped, stopping run & render loops"),this.animFrame&&(window.cancelAnimationFrame(this.animFrame),this.animFrame=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}}]),t}();e.a=p},/*!***************************!*\
  !*** ./js/Scene/Scene.js ***!
  \***************************/
function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../Resource/ResourceManager */5),o=i(/*! ../Map/Map */15),a=i(/*! ../Notification/NotificationManager */9),u=i(/*! ../Input/InputManager */10),l=i(/*! ../Util/Dom */6),h=i(/*! ../Util/Deferred */0),c=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();window.scenes={};var f=function(){function t(e){r(this,t),e=e||{},this.layers=new Array(e.layers||2),this.readyDef=null,this.resources=e.resources||[],this.pics={},this.map=null,this.mapOffsetX=0,this.mapOffsetY=0,this.loaded=!1,this.running=!1,this.backgroundImage=null,this.name=e.name||"Scene"+t.count++,this.opacity=void 0!==e.opacity?e.opacity:1,this.hudScene=e.hudScene||null,this.time=null,this.playTime=null,window.scenes[this.name]=this,this._objectsToAdd=[],this.isDebug=!1}return c(t,[{key:"_prepareCanvas",value:function(){this.resources&&this.display.prepareCanvas(this.resources)}},{key:"_emptyLayers",value:function(){for(var t=0;t<this.layers.length;++t)this.layers[t]=[]}},{key:"_getResourcesRef",value:function(){var t=this.resources;t&&t.forEach(function(t){t.elt=s.a.getResourceById(t.id)})}},{key:"fadeIn",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.animate("Fade",{startValue:0,endValue:1,duration:t})}},{key:"fadeOut",value:function(t){return this.animate("Fade",{startValue:1,endValue:0,duration:t})}},{key:"fadeInAndOut",value:function(t,e,i){var n=this,r=new h.a;return this.fadeIn(t).then(function(){setTimeout(function(){n.fadeOut(i).then(function(){r.resolve()})},e)}),r.promise}},{key:"_loadResources",value:function(t,e){var i=this;return this.loaded?(console.log("[Scene "+this.name+"] _loadResources() - Scene is loaded."),this._onLoad()):(console.log("[Scene "+this.name+"] _loadResources() - Loading scene."),this.readyDef=s.a.addResources(t),this.readyDef.then(function(){i.loaded=!0,i._onLoad()}).catch(function(t){console.error(t)}),s.a.loadResources("any",e)),this.readyDef}},{key:"load",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.loaded)return void console.log("Scene already loaded");this.resources.push({type:t,src:e,id:i||e})}},{key:"loadImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.load("image",t,e||t)}},{key:"loadAudio",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.load("audio",t,e||t)}},{key:"loadMap",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.load("map",t,e||t)}},{key:"_load",value:function(){var t=this,e=new h.a;return this.hudScene&&!this.hudScene.loaded?this.hudScene._load().then(function(){t._loadResources(t.resources).then(function(){e.resolve(t)})}).catch(function(t){console.error(t)}):this._loadResources(this.resources).then(function(){return e.resolve(t)}),e.promise}},{key:"debug",value:function(t){var e=void 0!==t?t:!this.isDebug;this.isDebug=e,this.hudScene&&this.hudScene.debug(e),this.map&&this.map.debug(e)}},{key:"_onLoad",value:function(){var t=this;this._cacheImages(),this._getResourcesRef(),this._prepareCanvas(),this._objectsToAdd.forEach(function(e){return t.addObject.apply(t,n(e))})}},{key:"_cacheImages",value:function(){if(console.log("[Scene "+this.name+"] caching Images"),this.resources)try{for(var t=0,e=this.resources.length;t<e;t++){var i=this.resources[t].id,n=this.resources[t].src;"image"===this.resources[t].type&&(this.pics[i]=s.a.getResourceById(i),this.pics[n]=s.a.getResourceById(i))}}catch(t){throw t}}},{key:"setMap",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t instanceof o.a?this.map=t:this.map=new o.a(t),this.map.setScene(this),this.mapOffsetX=e,this.mapOffsetY=i,window.currentMap=this.map}},{key:"_setObjectImage",value:function(t){"function"!=typeof t.setImage||t.image||t.setImage(this.pics[t.imageId||t.imageSrc])}},{key:"_addObjectToLayer",value:function(t,e){this.layers[t].push(e),this._setObjectImage(e),e.setScene(this),e.layer=t}},{key:"addObject",value:function(t,e){if(!this.loaded)return void this._objectsToAdd.push(Array.from(arguments));var i=e||0;if(Array.isArray(t)){var n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;this._addObjectToLayer(i,u)}}catch(t){r=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw s}}}else this._addObjectToLayer(i,t)}},{key:"drawMap",value:function(t){this.map.isDirty&&(this.display.clearScreen(t),this.map.draw(t,!1,this.mapOffsetX,this.mapOffsetY))}},{key:"drawMapObjects",value:function(t){this.map.drawObjects(t,this.mapOffsetX,this.mapOffsetY)}},{key:"drawSceneObjects",value:function(t){for(var e=this,i=0,n=this.layers.length;i<n;i++)!function(i,n){for(var r=e.layers[i],s=t[i],o=0,a=r.length;o<a;o++){var u=r[o];u._draw(s),e.isDebug&&e.isDebug&&u.showHitBox(s),u.children.length&&u.children.forEach(function(t){t._draw(s),e.isDebug&&t.showHitBox(s)})}}(i)}},{key:"moveSceneObjects",value:function(t){for(var e=0,i=this.layers.length;e<i;e++)for(var n=this.layers[e],r=0,s=n.length;r<s;r++){var o=n[r];o.movable&&o.update(t)}}},{key:"setOpacity",value:function(t){this.opacity=t}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setBackgroundImage",value:function(t){this.backgroundImage=t,t instanceof Image?new l.a(this.display.target).css("backgroundImage","url("+t.src+")"):new l.a(this.display.target).css("backgroundImage","url("+t+")")}},{key:"setup",value:function(){this.hudScene&&this.hudScene.setup()}},{key:"_setup",value:function(){this._emptyLayers(),this.map&&this.map.reset(),u.a.clearEvents(),this.hudScene&&this.hudScene._setup()}},{key:"_start",value:function(){this.running=!0,this.time=(new Date).getTime(),this.playTime=null,this.hudScene&&this.hudScene._start()}},{key:"_stop",value:function(){this._reset(),this.stop()}},{key:"_reset",value:function(){this.debug(!1),this._objectsToAdd=[]}},{key:"start",value:function(){}},{key:"stop",value:function(){this.running=!1,this.hudScene&&this.hudScene.stop()}},{key:"pause",value:function(t){}},{key:"getPlayTime",value:function(){return(this.playTime?this.playTime:(new Date).getTime()-this.time)/1e3}},{key:"update",value:function(t){this.moveSceneObjects(t),this.map&&(this.map.update(t),this.map.checkCollisions(t))}},{key:"render",value:function(t){var e=t.length-1;this.map&&(this.drawMap(t[e]),this.drawMapObjects(t)),this.drawSceneObjects(t)}},{key:"setLayerPriority",value:function(t,e){this.display.setLayerZIndex(t,e?0:2)}},{key:"notify",value:function(t,e){a.a.notify(t,e)}},{key:"bindEvents",value:function(t){a.a.listen(t,this.onEvent.bind(this))}},{key:"onEvent",value:function(){}},{key:"setDisplay",value:function(t){this.display=t,this.hudScene&&this.hudScene.setDisplay(t)}},{key:"animate",value:function(t,e){return this.display.animate(t,e,this)}},{key:"removeObject",value:function(t){var e=this.layers[t.layer],i=e.indexOf(t);i>-1&&e.splice(i,1)}}]),t}();f.count=1,e.a=f},/*!*********************************************!*\
  !*** ./js/lib/fpscounter/fpscounter.min.js ***!
  \*********************************************/
function(t,e){/*
 * fpscounter.js
 *
 * A simple in-browser fps counter, suitable for using with a bookmarklet
 * 
 * @author Pete Otaqui <pete@otaqui.com>
 * @url https://github.com/pete-otaqui/fpscounter
 * @license Creative Commons Attribution 3.0 Unported
 * @license http://creativecommons.org/licenses/by/3.0/deed.en_GB
*/
!function(t){t.fpscounter=function(e){function i(t,e){return(!t[0]||e<t[0])&&(t[0]=e),(!t[1]||e>t[1])&&(t[1]=e),t}function n(){var t,e,s,o,a,h;C=!0,T=Date.now(),T>=S+E&&(t=Math.min(60,Math.round(1/(T-O)*1e3)),M.unshift(t),f.clearRect(0,0,u,l),M.length>j&&M.pop(),e=M.reduce(i,[]),s=e[0],o=e[1],a=o-s,f.fillStyle=k,f.beginPath(),f.moveTo(u,l),M.forEach(function(t,e){h=r(e,t,s,a),f.lineTo(h[0],h[1])}),f.lineTo(h[0],l),f.lineTo(u,l),f.fill(),f.stroke(),f.fillStyle="#fff",f.font=b,f.fillText(t,p,d),f.font=w,f.fillText(s,m,g),f.fillText(o,v,y),S=T),O=T,C&&(P=requestAnimationFrame(n))}function r(t,e,i,n){return[u-t,l-l*(e-i)/n]}function s(){O=Date.now(),M=[],S=O,n()}e=e||{};var o=t.fpscounter_options||{},a={remove_on_click:!1,width:100,height:50};Object.keys(a).forEach(function(t){e[t]=e[t]||o[t]||a[t]});var u=e.width,l=e.height,h=document.createElement("div");h.className="fpscounter",h.style.width=u+"px",h.style.height=l+"px";var c=document.createElement("canvas");c.className="fpscounter-canvas",c.width=u,c.height=l;var f=c.getContext("2d"),p=u/2-14,d=l/2+10,v=4,y=8,m=4,g=l-4,b="bold 30px Monospace",w="10px Monospace",k=f.createLinearGradient(0,0,0,l);k.addColorStop(0,"#001133"),k.addColorStop(1,"#112288");var x=f.createLinearGradient(0,0,0,l);x.addColorStop(0,"#2848d8"),x.addColorStop(1,"#3366ff"),f.lineWidth=1,f.strokeStyle=x;var _=document.createElement("style");_.textContent=".fpscounter { position: fixed; top: 0; right: 0; background-color: #000; color: #fff; font-size: 30px; font-family: monospace;z-index: 999999}",h.appendChild(c),document.body.appendChild(h),document.querySelector("head").appendChild(_);var O,T,S,E,P,C,M=[],j=u;E=100,h.addEventListener("click",function(){C=!C,C?s():(cancelAnimationFrame(P),e.remove_on_click&&document.body.removeChild(h))}),s()},!t.fpscounter_options||t.fpscounter_options.auto_start}(window),t.exports=fpscounter},/*!******************************!*\
  !*** ./~/process/browser.js ***!
  \******************************/
function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(h===setTimeout)return setTimeout(t,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function s(t){if(c===clearTimeout)return clearTimeout(t);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(t);try{return c(t)}catch(e){try{return c.call(null,t)}catch(e){return c.call(this,t)}}}function o(){v&&p&&(v=!1,p.length?d=p.concat(d):y=-1,d.length&&a())}function a(){if(!v){var t=r(o);v=!0;for(var e=d.length;e;){for(p=d,d=[];++y<e;)p&&p[y].run();y=-1,e=d.length}p=null,v=!1,s(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var h,c,f=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(t){h=i}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(t){c=n}}();var p,d=[],v=!1,y=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];d.push(new u(t,e)),1!==d.length||v||r(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},/*!**************************************!*\
  !*** ./~/web-audio-daw/build/wad.js ***!
  \**************************************/
function(t,e,i){var n,r;!function(i,s){n=[],void 0!==(r=function(){return i.Wad=s()}.apply(e,n))&&(t.exports=r)}(this,function(){!function(t){var e=function(t,e){var i=e||{},n=i.bufferLen||4096,r=i.numChannels||2;this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,n,r,r);var s=new Worker(i.workerPath||"recorderWorker.js");s.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:r}});var o,a=!1;this.node.onaudioprocess=function(t){if(a){for(var e=[],i=0;i<r;i++)e.push(t.inputBuffer.getChannelData(i));s.postMessage({command:"record",buffer:e})}},this.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])},this.record=function(){a=!0},this.stop=function(){a=!1},this.clear=function(){s.postMessage({command:"clear"})},this.getBuffer=function(t){o=t||i.callback,s.postMessage({command:"getBuffer"})},this.exportWAV=function(t,e){if(o=t||i.callback,e=e||i.type||"audio/wav",!o)throw new Error("Callback not set");s.postMessage({command:"exportWAV",type:e})},s.onmessage=function(t){var e=t.data;o(e)},t.connect(this.node),this.node.connect(this.context.destination)};e.forceDownload=function(e,i){var n=(t.URL||t.webkitURL).createObjectURL(e),r=t.document.createElement("a");r.href=n,r.download=i||"output.wav";var s=document.createEvent("Event");s.initEvent("click",!0,!0),r.dispatchEvent(s)},t.Recorder=e}(window),function(e){function i(){return n}function n(t){if(!(this instanceof n))return new n(t);if(e.AudioContext||(e.AudioContext=e.webkitAudioContext),t||(console.log("tuna.js: Missing audio context! Creating a new context for you."),t=e.AudioContext&&new e.AudioContext),!t)throw new Error("Tuna cannot initialize because this environment does not support web audio.");r(t),h=t,c=this}function r(t){function e(){var t=Array.prototype.shift.apply(arguments);return t=p.isPrototypeOf?p.isPrototypeOf(t)?t.input:t:t.input||t,arguments=Array.prototype.slice.call(arguments),arguments.unshift(t),r.apply(this,arguments),t}if(!0!==t.__connectified__){var i=t.createGain(),n=Object.getPrototypeOf(Object.getPrototypeOf(i)),r=n.connect;n.connect=e,t.__connectified__=!0}}function s(t){return Math.max(0,Math.round(100*Math.pow(2,t/6))/100)}function o(t,e){var i,n,r=0,s=0,o=0,a=0;return i=t.toExponential().match(/^.\.?(.*)e(.+)$/),r=parseInt(i[2],10)-(i[1]+"").length,i=e.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(i[2],10)-(i[1]+"").length,s>r&&(r=s),n=t%e,r<-100||r>20?(o=Math.round(Math.log(n)/Math.log(10)),a=Math.pow(10,o),(n/a).toFixed(o-r)*a):parseFloat(n.toFixed(-r))}function a(t){return 0===t?1:Math.abs(t)/t}function u(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function l(t,e){return void 0===t?e:t}var h,c,f=function(t,e){t.value=e},p=Object.create(null,{activate:{writable:!0,value:function(t){t?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(t)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(t){this._lastBypassValue!==t&&(this._bypass=t,this.activate(!t),this._lastBypassValue=t)}},connect:{value:function(t){this.output.connect(t)}},disconnect:{value:function(t){this.output.disconnect(t)}},connectInOrder:{value:function(t){for(var e=t.length-1;e--;){if(!t[e].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",t[e]);t[e+1].input?t[e].connect(t[e+1].input):t[e].connect(t[e+1])}}},getDefaults:{value:function(){var t={};for(var e in this.defaults)t[e]=this.defaults[e].value;return t}},automate:{value:function(t,e,i,n){var r,s=n?~~(n/1e3):h.currentTime,o=i?~~(i/1e3):0,a=this.defaults[t],u=this[t];u?a.automatable?(i?(r="linearRampToValueAtTime",u.cancelScheduledValues(s),u.setValueAtTime(u.value,s)):r="setValueAtTime",u[r](e,o+s)):u=e:console.error("Invalid Property for "+this.name)}}}),d="float",v="int";void 0!==t&&t.exports?t.exports=n:e.define("Tuna",i),n.prototype.Bitcrusher=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=h.createGain(),this.activateNode=h.createGain(),this.processor=h.createScriptProcessor(this.bufferSize,1,1),this.output=h.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var e,i,n,r,s,o=0,a=0;this.processor.onaudioprocess=function(t){for(e=t.inputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(0),n=Math.pow(.5,this.bits),s=e.length,r=0;r<s;r++)o+=this.normfreq,o>=1&&(o-=1,a=n*Math.floor(e[r]/n+.5)),i[r]=a},this.bits=t.bits||this.defaults.bits.value,this.normfreq=l(t.normfreq,this.defaults.normfreq.value),this.bypass=t.bypass||!1},n.prototype.Bitcrusher.prototype=Object.create(p,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:v},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:v},bypass:{value:!1,automatable:!1,type:"boolean"},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:d}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(t){this.processor.bits=t}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(t){this.processor.normfreq=t}}}),n.prototype.Cabinet=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.activateNode=h.createGain(),this.convolver=this.newConvolver(t.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=h.createGain(),this.output=h.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=l(t.makeupGain,this.defaults.makeupGain),this.bypass=t.bypass||!1},n.prototype.Cabinet.prototype=Object.create(p,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:d},bypass:{value:!1,automatable:!1,type:"boolean"}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=t}},newConvolver:{value:function(t){return new c.Convolver({impulse:t,dryLevel:0,wetLevel:1})}}}),n.prototype.Chorus=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.attenuator=this.activateNode=h.createGain(),this.splitter=h.createChannelSplitter(2),this.delayL=h.createDelay(),this.delayR=h.createDelay(),this.feedbackGainNodeLR=h.createGain(),this.feedbackGainNodeRL=h.createGain(),this.merger=h.createChannelMerger(2),this.output=h.createGain(),this.lfoL=new c.LFO({target:this.delayL.delayTime,callback:f}),this.lfoR=new c.LFO({target:this.delayR.delayTime,callback:f}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=l(t.feedback,this.defaults.feedback.value),this.rate=l(t.rate,this.defaults.rate.value),this.delay=l(t.delay,this.defaults.delay.value),this.depth=l(t.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},n.prototype.Chorus.prototype=Object.create(p,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:d},delay:{value:.0045,min:0,max:1,automatable:!1,type:d},depth:{value:.7,min:0,max:1,automatable:!1,type:d},rate:{value:1.5,min:0,max:8,automatable:!1,type:d},bypass:{value:!1,automatable:!1,type:"boolean"}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(t){this._delay=2*Math.pow(10,t)*2e-4,this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),n.prototype.Compressor=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.compNode=this.activateNode=h.createDynamicsCompressor(),this.makeupNode=h.createGain(),this.output=h.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=l(t.automakeup,this.defaults.automakeup.value),this.makeupGain=t.makeupGain||this.defaults.makeupGain.value,this.threshold=l(t.threshold,this.defaults.threshold.value),this.release=t.release||this.defaults.release.value,this.attack=l(t.attack,this.defaults.attack.value),this.ratio=t.ratio||this.defaults.ratio.value,this.knee=l(t.knee,this.defaults.knee.value),this.bypass=t.bypass||!1},n.prototype.Compressor.prototype=Object.create(p,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:d},release:{value:250,min:10,max:2e3,automatable:!0,type:d},makeupGain:{value:1,min:1,max:100,automatable:!0,type:d},attack:{value:1,min:0,max:1e3,automatable:!0,type:d},ratio:{value:4,min:1,max:50,automatable:!0,type:d},knee:{value:5,min:0,max:40,automatable:!0,type:d},automakeup:{value:!1,automatable:!1,type:"boolean"},bypass:{value:!1,automatable:!1,type:"boolean"}}},computeMakeup:{value:function(){var t=this.compNode;return-(t.threshold.value-t.threshold.value/t.ratio.value)/4}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(t){this._automakeup=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(t){this.compNode.threshold.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(t){this.compNode.ratio.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(t){this.compNode.knee.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(t){this.compNode.attack.value=t/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(t){this.compNode.release=t/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=s(t)}}}),n.prototype.Convolver=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.activateNode=h.createGain(),this.convolver=h.createConvolver(),this.dry=h.createGain(),this.filterLow=h.createBiquadFilter(),this.filterHigh=h.createBiquadFilter(),this.wet=h.createGain(),this.output=h.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=l(t.dryLevel,this.defaults.dryLevel.value),this.wetLevel=l(t.wetLevel,this.defaults.wetLevel.value),this.highCut=t.highCut||this.defaults.highCut.value,this.buffer=t.impulse||"../impulses/ir_rev_short.wav",this.lowCut=t.lowCut||this.defaults.lowCut.value,this.level=l(t.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=t.bypass||!1},n.prototype.Convolver.prototype=Object.create(p,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:d},lowCut:{value:20,min:20,max:22050,automatable:!0,type:d},dryLevel:{value:1,min:0,max:1,automatable:!0,type:d},wetLevel:{value:1,min:0,max:1,automatable:!0,type:d},level:{value:1,min:0,max:1,automatable:!0,type:d}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(t){this.filterLow.frequency.value=t}},highCut:{get:function(){return this.filterHigh.frequency},set:function(t){this.filterHigh.frequency.value=t}},level:{get:function(){return this.output.gain},set:function(t){this.output.gain.value=t}},dryLevel:{get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},wetLevel:{get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(t){var e=this.convolver,i=new XMLHttpRequest;if(!t)return void console.log("Tuna.Convolver.setBuffer: Missing impulse path!");i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(i.status<300&&i.status>199||302===i.status)&&h.decodeAudioData(i.response,function(t){e.buffer=t},function(t){t&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+t)})},i.send(null)}}}),n.prototype.Delay=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.activateNode=h.createGain(),this.dry=h.createGain(),this.wet=h.createGain(),this.filter=h.createBiquadFilter(),this.delay=h.createDelay(),this.feedbackNode=h.createGain(),this.output=h.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=t.delayTime||this.defaults.delayTime.value,this.feedback=l(t.feedback,this.defaults.feedback.value),this.wetLevel=l(t.wetLevel,this.defaults.wetLevel.value),this.dryLevel=l(t.dryLevel,this.defaults.dryLevel.value),this.cutoff=t.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=t.bypass||!1},n.prototype.Delay.prototype=Object.create(p,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:d},feedback:{value:.45,min:0,max:.9,automatable:!0,type:d},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:d},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:d},dryLevel:{value:1,min:0,max:1,automatable:!0,type:d}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(t){this.delay.delayTime.value=t/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(t){this.feedbackNode.gain.value=t}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),n.prototype.Filter=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.activateNode=h.createGain(),this.filter=h.createBiquadFilter(),this.output=h.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=t.frequency||this.defaults.frequency.value,this.Q=t.resonance||this.defaults.Q.value,this.filterType=l(t.filterType,this.defaults.filterType.value),this.gain=l(t.gain,this.defaults.gain.value),this.bypass=t.bypass||!1},n.prototype.Filter.prototype=Object.create(p,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:d},Q:{value:1,min:.001,max:100,automatable:!0,type:d},gain:{value:0,min:-40,max:40,automatable:!0,type:d},bypass:{value:!1,automatable:!1,type:"boolean"},filterType:{value:"lowpass",automatable:!1,type:"string"}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(t){this.filter.type=t}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(t){this.filter.Q.value=t}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(t){this.filter.gain.value=t}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),n.prototype.MoogFilter=function(t){t||(t=this.getDefaults()),this.bufferSize=t.bufferSize||this.defaults.bufferSize.value,this.input=h.createGain(),this.activateNode=h.createGain(),this.processor=h.createScriptProcessor(this.bufferSize,1,1),this.output=h.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var e,i,n,r,s,o,a,u;e=i=n=r=s=o=a=u=0;var c,f,p,d,v,y;this.processor.onaudioprocess=function(t){for(c=t.inputBuffer.getChannelData(0),f=t.outputBuffer.getChannelData(0),p=1.16*this.cutoff,inputFactor=p*p*.35013*(p*p),d=this.resonance*(1-.15*p*p),y=c.length,v=0;v<y;v++)c[v]-=u*d,c[v]*=inputFactor,s=c[v]+.3*e+(1-p)*s,e=c[v],o=s+.3*i+(1-p)*o,i=s,a=o+.3*n+(1-p)*a,n=o,u=a+.3*r+(1-p)*u,r=a,f[v]=u},this.cutoff=l(t.cutoff,this.defaults.cutoff.value),this.resonance=l(t.resonance,this.defaults.resonance.value),this.bypass=t.bypass||!1},n.prototype.MoogFilter.prototype=Object.create(p,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:v},bypass:{value:!1,automatable:!1,type:"boolean"},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:d},resonance:{value:3.5,min:0,max:4,automatable:!1,type:d}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(t){this.processor.cutoff=t}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(t){this.processor.resonance=t}}}),n.prototype.Overdrive=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.activateNode=h.createGain(),this.inputDrive=h.createGain(),this.waveshaper=h.createWaveShaper(),this.outputDrive=h.createGain(),this.output=h.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=l(t.drive,this.defaults.drive.value),this.outputGain=l(t.outputGain,this.defaults.outputGain.value),this.curveAmount=l(t.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=l(t.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=t.bypass||!1},n.prototype.Overdrive.prototype=Object.create(p,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:d,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:d,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:d},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:v}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(t){this._drive=t}},curveAmount:{get:function(){return this._curveAmount},set:function(t){this._curveAmount=t,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(t){this._outputGain=s(t)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(t){this._algorithmIndex=t,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(t,e,i){t=Math.min(t,.9999);var n,r,s=2*t/(1-t);for(n=0;n<e;n++)r=2*n/e-1,i[n]=(1+s)*r/(1+s*Math.abs(r))},function(t,e,i){var n,r,s;for(n=0;n<e;n++)r=2*n/e-1,s=(.5*Math.pow(r+1.4,2)-1)*s>=0?5.8:1.2,i[n]=u(s)},function(t,e,i){var n,r,s,o=1-t;for(n=0;n<e;n++)r=2*n/e-1,s=r<0?-Math.pow(Math.abs(r),o+.04):Math.pow(r,o),i[n]=u(2*s)},function(t,e,i){var n,r,s,o,u=1-t>.99?.99:1-t;for(n=0;n<e;n++)r=2*n/e-1,o=Math.abs(r),o<u?s=o:o>u?s=u+(o-u)/(1+Math.pow((o-u)/(1-u),2)):o>1&&(s=o),i[n]=a(r)*s*(1/((u+1)/2))},function(t,e,i){var n,r;for(n=0;n<e;n++)r=2*n/e-1,i[n]=r<-.08905?-.75*(1-Math.pow(1-(Math.abs(r)-.032857),12)+1/3*(Math.abs(r)-.032847))+.01:r>=-.08905&&r<.320018?r*r*-6.153+3.9375*r:.630035},function(t,e,i){var n,r,s=2+Math.round(14*t),o=Math.round(Math.pow(2,s-1));for(n=0;n<e;n++)r=2*n/e-1,i[n]=Math.round(r*o)/o}]}}),n.prototype.Phaser=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.splitter=this.activateNode=h.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=h.createGain(),this.feedbackGainNodeR=h.createGain(),this.merger=h.createChannelMerger(2),this.filteredSignal=h.createGain(),this.output=h.createGain(),this.lfoL=new c.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new c.LFO({target:this.filtersR,callback:this.callback});for(var e=this.stage;e--;)this.filtersL[e]=h.createBiquadFilter(),this.filtersR[e]=h.createBiquadFilter(),this.filtersL[e].type="allpass",this.filtersR[e].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=l(t.rate,this.defaults.rate.value),this.baseModulationFrequency=t.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=l(t.depth,this.defaults.depth.value),this.feedback=l(t.feedback,this.defaults.feedback.value),this.stereoPhase=l(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},n.prototype.Phaser.prototype=Object.create(p,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:d},depth:{value:.6,min:0,max:1,automatable:!1,type:d},feedback:{value:.7,min:0,max:1,automatable:!1,type:d},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:d},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:d}}},callback:{value:function(t,e){for(var i=0;i<4;i++)t[i].frequency.value=e}},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(t){this._baseModulationFrequency=t,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=o(e,2*Math.PI),this.lfoR._phase=e}}}),n.prototype.PingPongDelay=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.wetLevel=h.createGain(),this.stereoToMonoMix=h.createGain(),this.feedbackLevel=h.createGain(),this.output=h.createGain(),this.delayLeft=h.createDelay(),this.delayRight=h.createDelay(),this.activateNode=h.createGain(),this.splitter=h.createChannelSplitter(2),this.merger=h.createChannelMerger(2),this.activateNode.connect(this.splitter),this.splitter.connect(this.stereoToMonoMix,0,0),this.splitter.connect(this.stereoToMonoMix,1,0),this.stereoToMonoMix.gain.value=.5,this.stereoToMonoMix.connect(this.wetLevel),this.wetLevel.connect(this.delayLeft),this.feedbackLevel.connect(this.delayLeft),this.delayLeft.connect(this.delayRight),this.delayRight.connect(this.feedbackLevel),this.delayLeft.connect(this.merger,0,0),this.delayRight.connect(this.merger,0,1),this.merger.connect(this.output),this.activateNode.connect(this.output),this.delayTimeLeft=void 0!==t.delayTimeLeft?t.delayTimeLeft:this.defaults.delayTimeLeft.value,this.delayTimeRight=void 0!==t.delayTimeRight?t.delayTimeRight:this.defaults.delayTimeRight.value,this.feedbackLevel.gain.value=void 0!==t.feedback?t.feedback:this.defaults.feedback.value,this.wetLevel.gain.value=void 0!==t.wetLevel?t.wetLevel:this.defaults.wetLevel.value,this.bypass=t.bypass||!1},n.prototype.PingPongDelay.prototype=Object.create(p,{name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:!0,get:function(){return this._delayTimeLeft},set:function(t){this._delayTimeLeft=t,this.delayLeft.delayTime.value=t/1e3}},delayTimeRight:{enumerable:!0,get:function(){return this._delayTimeRight},set:function(t){this._delayTimeRight=t,this.delayRight.delayTime.value=t/1e3}},defaults:{writable:!0,value:{delayTimeLeft:{value:200,min:1,max:1e4,automatable:!1,type:v},delayTimeRight:{value:400,min:1,max:1e4,automatable:!1,type:v},feedback:{value:.3,min:0,max:1,automatable:!1,type:d},wetLevel:{value:.5,min:0,max:1,automatable:!1,type:d}}}}),n.prototype.Tremolo=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.splitter=this.activateNode=h.createChannelSplitter(2),this.amplitudeL=h.createGain(),this.amplitudeR=h.createGain(),this.merger=h.createChannelMerger(2),this.output=h.createGain(),this.lfoL=new c.LFO({target:this.amplitudeL.gain,callback:f}),this.lfoR=new c.LFO({target:this.amplitudeR.gain,callback:f}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=t.rate||this.defaults.rate.value,this.intensity=l(t.intensity,this.defaults.intensity.value),this.stereoPhase=l(t.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},n.prototype.Tremolo.prototype=Object.create(p,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:d},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:d},rate:{value:5,min:.1,max:11,automatable:!1,type:d}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(t){this._intensity=t,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._rate},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=o(e,2*Math.PI),this.lfoR.phase=e}}}),n.prototype.WahWah=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.activateNode=h.createGain(),this.envelopeFollower=new c.EnvelopeFollower({target:this,callback:function(t,e){t.sweep=e}}),this.filterBp=h.createBiquadFilter(),this.filterPeaking=h.createBiquadFilter(),this.output=h.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=l(t.enableAutoMode,this.defaults.automode.value),this.resonance=t.resonance||this.defaults.resonance.value,this.sensitivity=l(t.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=l(t.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=t.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=l(t.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=t.bypass||!1},n.prototype.WahWah.prototype=Object.create(p,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:"boolean"},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:d},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:d},sweep:{value:.2,min:0,max:1,automatable:!1,type:d},resonance:{value:10,min:1,max:100,automatable:!1,type:d},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:d}}},activateCallback:{value:function(t){this.automode=t}},automode:{get:function(){return this._automode},set:function(t){this._automode=t,t?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}catch(t){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(t){this._sweep=Math.pow(t>1?1:t<0?0:t,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=50*Math.pow(10,2*t),this._excursionFrequency=Math.min(h.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(t){this._excursionOctaves=t,this._excursionFrequency=Math.min(h.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(t){this._sensitivity=Math.pow(10,t)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(t){this._resonance=t,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),n.prototype.EnvelopeFollower=function(t){t||(t=this.getDefaults()),this.input=h.createGain(),this.jsNode=this.output=h.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=l(t.attackTime,this.defaults.attackTime.value),this.releaseTime=l(t.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=t.target||{},this.callback=t.callback||function(){}},n.prototype.EnvelopeFollower.prototype=Object.create(p,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:d},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:d}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(t){this._attackTime=t,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(t){this._releaseTime=t,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(t){"function"==typeof t?this._callback=t:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(h.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(t){return function(e){t.compute(e)}}},compute:{value:function(t){var e,i,n,r,s=t.inputBuffer.getChannelData(0).length,o=t.inputBuffer.numberOfChannels;if(i=n=r=0,o>1)for(r=0;r<s;++r)for(;i<o;++i)e=t.inputBuffer.getChannelData(i)[r],n+=e*e/o;else for(r=0;r<s;++r)e=t.inputBuffer.getChannelData(0)[r],n+=e*e;n=Math.sqrt(n),this._envelope<n?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*n):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*n),this._callback(this._target,this._envelope)}}}),n.prototype.LFO=function(t){this.output=h.createScriptProcessor(256,1,1),this.activateNode=h.destination,this.frequency=l(t.frequency,this.defaults.frequency.value),this.offset=l(t.offset,this.defaults.offset.value),this.oscillation=l(t.oscillation,this.defaults.oscillation.value),this.phase=l(t.phase,this.defaults.phase.value),this.target=t.target||{},this.output.onaudioprocess=this.callback(t.callback||function(){}),this.bypass=t.bypass||!1},n.prototype.LFO.prototype=Object.create(p,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:d},offset:{value:.85,min:0,max:22049,automatable:!1,type:d},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:d},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:d}}},frequency:{get:function(){return this._frequency},set:function(t){this._frequency=t,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(t){this._offset=t}},oscillation:{get:function(){return this._oscillation},set:function(t){this._oscillation=t}},phase:{get:function(){return this._phase},set:function(t){this._phase=t}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){t?this.output.connect(h.destination):this.output.disconnect(h.destination)}},callback:{value:function(t){var e=this;return function(){e._phase+=e._phaseInc,e._phase>2*Math.PI&&(e._phase=0),t(e._target,e._offset+e._oscillation*Math.sin(e._phase))}}}}),n.toString=n.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}}(this);var e=window.AudioContext||window.webkitAudioContext,i=new e;({UNSUPPORT:!1,SUPPORT_STANDARD_VERSION:1,SUPPORT_DEPRECATED_VERSION:2,isGetUserMediaSupported:function(t){return t.navigator.mediaDevices.getUserMedia?this.SUPPORT_STANDARD_VERSION:t.navigator.getUserMedia?this.SUPPORT_DEPRECATED_VERSION:this.UNSUPPORT},initialize:function(t){t.navigator.mediaDevices=t.navigator.mediaDevices||{},t.navigator.getUserMedia=t.navigator.getUserMedia||t.navigator.webkitGetUserMedia||t.navigator.mozGetUserMedia;var e=this.isGetUserMediaSupported(t);e!=this.UNSUPPORT&&(t.getUserMedia=e==this.SUPPORT_STANDARD_VERSION?t.navigator.mediaDevices.getUserMedia.bind(t.navigator.mediaDevices):function(e){return new Promise(function(i,n){t.navigator.getUserMedia(e,i,n)})})}}).initialize(window),window.getUserMedia?console.log("Your browser supports getUserMedia."):console.log("Your browser does not support getUserMedia.");var n=function(){function t(t,e){var i=-1,n=0,r=0,s=!1;if(t.length<1996)return-1;for(var o=0;o<1e3;o++){var a=(t[o]-128)/128;r+=a*a}if((r=Math.sqrt(r/1e3))<.01)return-1;for(var u=1,l=4;l<=1e3;l++){for(var h=0,o=0;o<1e3;o++)h+=Math.abs((t[o]-128)/128-(t[o+l]-128)/128);if((h=1-h/1e3)>.9&&h>u)s=!0;else if(s)return e/i;u=h,h>n&&(n=h,i=l)}return n>.01?e/i:-1}var e=function(){Math.seed=6,Math.seededRandom=function(t,e){return t=t||1,e=e||0,Math.seed=(9301*Math.seed+49297)%233280,e+Math.seed/233280*(t-e)};for(var t=2*i.sampleRate,e=i.createBuffer(1,t,i.sampleRate),n=e.getChannelData(0),r=0;r<t;r++)n[r]=2*Math.seededRandom()-1;return e}(),n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=function(t,e){t.env={attack:e.env?j(e.env.attack,1):0,decay:e.env?j(e.env.decay,0):0,sustain:e.env?j(e.env.sustain,1):1,hold:e.env?j(e.env.hold,3.14159):3.14159,release:e.env?j(e.env.release,0):0},t.defaultEnv={attack:e.env?j(e.env.attack,1):0,decay:e.env?j(e.env.decay,0):0,sustain:e.env?j(e.env.sustain,1):1,hold:e.env?j(e.env.hold,3.14159):3.14159,release:e.env?j(e.env.release,0):0}},s=function(t,e){e.filter?n(e.filter)?t.filter=e.filter.map(function(t){return{type:t.type||"lowpass",frequency:t.frequency||600,q:t.q||1,env:t.env||null}}):t.filter=[{type:e.filter.type||"lowpass",frequency:e.filter.frequency||600,q:e.filter.q||1,env:e.filter.env||null}]:e.filter=null},o=function(t,e){var n=new XMLHttpRequest;n.open("GET",t.source,!0),n.responseType="arraybuffer",t.playable--,n.onload=function(){i.decodeAudioData(n.response,function(i){t.decodedBuffer=i,3.14159===t.env.hold&&(t.env.hold=t.decodedBuffer.duration+1),e&&e(t),t.playable++,t.playOnLoad&&t.play(t.playOnLoadArg)})},n.send()},a=function(t,e){e.vibrato?t.vibrato={shape:j(e.vibrato.shape,"sine"),speed:j(e.vibrato.speed,1),magnitude:j(e.vibrato.magnitude,5),attack:j(e.vibrato.attack,0)}:t.vibrato=null},u=function(t,e){e.tremolo?t.tremolo={shape:j(e.tremolo.shape,"sine"),speed:j(e.tremolo.speed,1),magnitude:j(e.tremolo.magnitude,5),attack:j(e.tremolo.attack,1)}:t.tremolo=null},l=function(t,e){if(e.reverb){t.reverb={wet:j(e.reverb.wet,1)};var n=e.reverb.impulse||d.defaultImpulse,r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="arraybuffer",t.playable--,r.onload=function(){i.decodeAudioData(r.response,function(i){t.reverb.buffer=i,t.playable++,t.playOnLoad&&t.play(t.playOnLoadArg),t instanceof d.Poly&&t.setUp(e),"mic"===t.source&&t.reverb&&t.reverb.buffer&&t.reverb.node&&!t.reverb.node.buffer&&(t.reverb.node.convolver.buffer=t.reverb.buffer)})},r.send()}else t.reverb=null},h=function(t,e){"panning"in e?(t.panning={location:e.panning},"number"==typeof e.panning?t.panning.type="stereo":(t.panning.type="3d",t.panning.panningModel=e.panningModel||"equalpower")):t.panning={location:0,type:"stereo"},"stereo"!==t.panning.type||i.createStereoPanner||(console.log("Your browser does not support stereo panning. Falling back to 3D panning."),t.panning={location:[0,0,0],type:"3d",panningModel:"equalpower"})},c=function(t,e){e.delay?t.delay={delayTime:j(e.delay.delayTime,.5),maxDelayTime:j(e.delay.maxDelayTime,2),feedback:j(e.delay.feedback,.25),wet:j(e.delay.wet,.25)}:t.delay=null},f=function(t,e){t.nodes=[],t.mediaStreamSource=null,t.gain=null,getUserMedia({audio:!0,video:!1}).then(function(n){t.mediaStreamSource=i.createMediaStreamSource(n),d.micConsent=!0,p(t,e)}).catch(function(t){console.log("Error setting up microphone input: ",t)})},p=function(t,e){t.nodes=[],t.gain=i.createGain(),t.gain.gain.value=j(e.volume,t.volume),t.nodes.push(t.mediaStreamSource),t.nodes.push(t.gain),(t.filter||e.filter)&&w(t,e),(t.reverb||e.reverb)&&x(t,e),h(t,e),_(t,e),(t.delay||e.delay)&&S(t,e),P(t,e),t.setUpExternalFxOnPlay(e,i)},d=function(t){if(this.source=t.source,this.destination=t.destination||i.destination,this.volume=j(t.volume,1),this.defaultVolume=this.volume,this.playable=1,this.pitch=d.pitches[t.pitch]||t.pitch||440,this.detune=t.detune||0,this.globalReverb=t.globalReverb||!1,this.gain=[],this.loop=t.loop||!1,this.tuna=t.tuna||null,r(this,t),s(this,t),a(this,t),u(this,t),l(this,t),this.constructExternalFx(t,i),h(this,t),c(this,t),"noise"===this.source)this.decodedBuffer=e;else if("mic"===this.source)f(this,t);else if("object"==typeof this.source){var n=i.createBuffer(2,this.source[0].length,i.sampleRate);n.getChannelData(0).set(this.source[0]),n.getChannelData(1).set(this.source[1]),this.decodedBuffer=n}else this.source in{sine:0,sawtooth:0,square:0,triangle:0}?t.callback&&t.callback(this):o(this,t.callback)};d.micConsent=!1,d.audioContext=i,void 0!=window.Tuna&&(d.tuna=new Tuna(d.audioContext));var v=function(t,e){t.filter.forEach(function(t,i){t.node.frequency.linearRampToValueAtTime(t.frequency,e.exactTime),t.node.frequency.linearRampToValueAtTime(t.env.frequency,e.exactTime+t.env.attack)})},y=function(t,e){t.gain[0].gain.linearRampToValueAtTime(1e-4,e.exactTime),t.gain[0].gain.linearRampToValueAtTime(t.volume,e.exactTime+t.env.attack+1e-5),t.gain[0].gain.linearRampToValueAtTime(t.volume*t.env.sustain,e.exactTime+t.env.attack+t.env.decay+2e-5),t.gain[0].gain.linearRampToValueAtTime(t.volume*t.env.sustain,e.exactTime+t.env.attack+t.env.decay+t.env.hold+3e-5),t.gain[0].gain.linearRampToValueAtTime(1e-4,e.exactTime+t.env.attack+t.env.decay+t.env.hold+t.env.release+4e-5),t.soundSource.start(e.exactTime),t.soundSource.stop(e.exactTime+t.env.attack+t.env.decay+t.env.hold+t.env.release)},m=function(t,e){for(var i=e&&e.destination||t.destination,n=1;n<t.nodes.length;n++){if("custom"===t.nodes[n-1].interface)var r=t.nodes[n-1].output;else var r=t.nodes[n-1];if("custom"===t.nodes[n].interface)var s=t.nodes[n].input;else var s=t.nodes[n];r.connect(s)}if("custom"===t.nodes[t.nodes.length-1].interface)var o=t.nodes[t.nodes.length-1].output;else var o=t.nodes[t.nodes.length-1];o.connect(i),d.reverb&&t.globalReverb&&(t.nodes[t.nodes.length-1].connect(d.reverb.node),d.reverb.node.connect(d.reverb.gain),d.reverb.gain.connect(i))},g=function(t,e){e=e||{},t.soundSource=i.createOscillator(),t.soundSource.type=t.source,e.pitch?e.pitch in d.pitches?t.soundSource.frequency.value=d.pitches[e.pitch]:t.soundSource.frequency.value=e.pitch:t.soundSource.frequency.value=t.pitch,t.soundSource.detune.value=e.detune||t.detune},b=function(t,e){e&&e.env?(t.env.attack=j(e.env.attack,t.defaultEnv.attack),t.env.decay=j(e.env.decay,t.defaultEnv.decay),t.env.sustain=j(e.env.sustain,t.defaultEnv.sustain),t.env.hold=j(e.env.hold,t.defaultEnv.hold),t.env.release=j(e.env.release,t.defaultEnv.release)):t.env={attack:t.defaultEnv.attack,decay:t.defaultEnv.decay,sustain:t.defaultEnv.sustain,hold:t.defaultEnv.hold,release:t.defaultEnv.release}},w=function(t,e){e.filter&&!n(e.filter)&&(e.filter=[e.filter]),t.filter.forEach(function(n,r){n.node=i.createBiquadFilter(),n.node.type=n.type,n.node.frequency.value=e.filter&&e.filter[r]?e.filter[r].frequency||n.frequency:n.frequency,n.node.Q.value=e.filter&&e.filter[r]?e.filter[r].q||n.q:n.q,(e.filter&&e.filter[r].env||t.filter[r].env)&&"mic"!==t.source&&(n.env={attack:e.filter&&e.filter[r].env&&e.filter[r].env.attack||t.filter[r].env.attack,frequency:e.filter&&e.filter[r].env&&e.filter[r].env.frequency||t.filter[r].env.frequency}),t.nodes.push(n.node)})},k=function(t,e){e&&e.filter&&t.filter?(n(e.filter)||(e.filter=[e.filter]),w(t,e)):t.filter&&w(t,t)},x=function(t,e){var n={interface:"custom",input:i.createGain(),convolver:i.createConvolver(),wet:i.createGain(),output:i.createGain()};n.convolver.buffer=t.reverb.buffer,n.wet.gain.value=t.reverb.wet,n.input.connect(n.convolver),n.input.connect(n.output),n.convolver.connect(n.wet),n.wet.connect(n.output),t.reverb.node=n,t.nodes.push(t.reverb.node)},_=function(t,e){var n=e&&e.panning;void 0===n&&(n=t.panning.location),"number"==typeof n?(t.panning.node=i.createStereoPanner(),t.panning.node.pan.value=n,t.panning.type="stereo"):(t.panning.node=i.createPanner(),t.panning.node.setPosition(n[0],n[1],n[2]),t.panning.node.panningModel=e.panningModel||t.panningModel||"equalpower",t.panning.type="3d"),t.nodes.push(t.panning.node)},O=function(t,e){t.vibrato.wad=new d({source:t.vibrato.shape,pitch:t.vibrato.speed,volume:t.vibrato.magnitude,env:{attack:t.vibrato.attack},destination:t.soundSource.frequency}),t.vibrato.wad.play()},T=function(t,e){t.tremolo.wad=new d({source:t.tremolo.shape,pitch:t.tremolo.speed,volume:t.tremolo.magnitude,env:{attack:t.tremolo.attack,hold:10},destination:t.gain[0].gain}),t.tremolo.wad.play()},S=function(t,e){if(t.delay){e.delay||(e.delay={});var n={interface:"custom",input:i.createGain(),output:i.createGain(),delayNode:i.createDelay(t.delay.maxDelayTime),feedbackNode:i.createGain(),wetNode:i.createGain()};n.delayNode.delayTime.value=j(e.delay.delayTime,t.delay.delayTime),n.feedbackNode.gain.value=j(e.delay.feedback,t.delay.feedback),n.wetNode.gain.value=j(e.delay.wet,t.delay.wet),n.input.connect(n.delayNode),n.input.connect(n.output),n.delayNode.connect(n.feedbackNode),n.delayNode.connect(n.wetNode),n.feedbackNode.connect(n.delayNode),n.wetNode.connect(n.output),t.delay.delayNode=n,t.nodes.push(n)}},E=function(t,e){t.compressor=i.createDynamicsCompressor(),t.compressor.attack.value=j(e.compressor.attack,t.compressor.attack.value),t.compressor.knee.value=j(e.compressor.knee,t.compressor.knee.value),t.compressor.ratio.value=j(e.compressor.ratio,t.compressor.ratio.value),t.compressor.release.value=j(e.compressor.release,t.compressor.release.value),t.compressor.threshold.value=j(e.compressor.threshold,t.compressor.threshold.value),t.nodes.push(t.compressor)},P=function(t,e){if(t.tuna||e.tuna){var i={};if(t.tuna)for(var n in t.tuna)i[n]=t.tuna[n];if(e.tuna)for(var n in e.tuna)i[n]=e.tuna[n];console.log("tunaconfig: ",i);for(var n in i){console.log(n);var r=new d.tuna[n](i[n]);t.nodes.push(r)}}};d.prototype.constructExternalFx=function(t,e){},d.prototype.setUpExternalFxOnPlay=function(t,e){},d.prototype.play=function(t){return t=t||{arg:null},this.playable<1?(this.playOnLoad=!0,this.playOnLoadArg=t):"mic"===this.source?d.micConsent?null===t.arg?m(this,t):(s(this,t),a(this,t),u(this,t),l(this,t),this.constructExternalFx(t,i),h(this,t),c(this,t),p(this,t),m(this,t)):console.log("You have not given your browser permission to use your microphone."):(this.nodes=[],t.wait||(t.wait=0),t.volume?this.volume=t.volume:this.volume=this.defaultVolume,this.source in{sine:0,sawtooth:0,square:0,triangle:0}?g(this,t):(this.soundSource=i.createBufferSource(),this.soundSource.buffer=this.decodedBuffer,("noise"===this.source||this.loop||t.loop)&&(this.soundSource.loop=!0)),void 0===t.exactTime&&(t.exactTime=i.currentTime+t.wait),this.nodes.push(this.soundSource),b(this,t),k(this,t),P(this,t),this.setUpExternalFxOnPlay(t,i),this.gain.unshift(i.createGain()),this.gain[0].label=t.label,this.nodes.push(this.gain[0]),this.gain.length>15&&(this.gain.length=15),this.reverb&&x(this,t),_(this,t),S(this,t),m(this,t),this.filter&&this.filter[0].env&&v(this,t),y(this,t),this.vibrato&&O(this),this.tremolo&&T(this)),t.callback&&t.callback(this),this},d.prototype.setVolume=function(t){return this.defaultVolume=t,this.gain.length>0&&(this.gain[0].gain.value=t),this},d.prototype.setSpeed=function(t){var e;return e=t&&t>0?t:0,this.soundSource?this.soundSource.playbackRate.value=e:console.log("Sorry, but the wad does not contain a soundSource!"),this},d.prototype.setDetune=function(t){return this.soundSource.detune.value=t,this},d.prototype.setPanning=function(t){return this.panning.location=t,n(t)&&"3d"===this.panning.type&&this.panning.node?this.panning.node.setPosition(t[0],t[1],t[2]):"number"==typeof t&&"stereo"===this.panning.type&&this.panning.node&&(this.panning.node.pan.value=t),n(t)?this.panning.type="3d":"number"==typeof t&&(this.panning.type="stereo"),this},d.prototype.setReverb=function(t){var e;return e=t&&t>0&&t<1?t:t>=1?1:0,this.reverb?(this.reverb.wet=e,this.reverb.node&&(this.reverb.node.wet.gain.value=e)):console.log("Sorry, but the wad does not contain Reverb!"),this},d.prototype.setDelay=function(t,e,i){var n;n=t&&t>0?t:0;var r;r=e&&e>0&&e<1?e:e>=1?1:0;var s;return s=i&&i>0&&i<1?i:i>=1?1:0,this.delay?(this.delay.delayTime=n,this.delay.wet=r,this.delay.feedback=s,this.delay.delayNode&&(this.delay.delayNode.delayNode.delayTime.value=n,this.delay.delayNode.wetNode.gain.value=r,this.delay.delayNode.feedbackNode.gain.value=s)):console.log("Sorry, but the wad does not contain delay!"),this},d.prototype.stop=function(t){if("mic"!==this.source){if(t)for(var e=0;e<this.gain.length;e++)this.gain[e].label===t&&(this.gain[e].gain.cancelScheduledValues(i.currentTime),this.gain[e].gain.setValueAtTime(this.gain[e].gain.value,i.currentTime),this.gain[e].gain.linearRampToValueAtTime(1e-4,i.currentTime+this.env.release));t||(this.gain[0].gain.cancelScheduledValues(i.currentTime),this.gain[0].gain.setValueAtTime(this.gain[0].gain.value,i.currentTime),this.gain[0].gain.linearRampToValueAtTime(1e-4,i.currentTime+this.env.release))}else d.micConsent?this.mediaStreamSource.disconnect(0):console.log("You have not given your browser permission to use your microphone.");this.tremolo&&this.tremolo.wad.stop()};var C=new Uint8Array(2048),M=function(t){var e=Math.log(t/440)/Math.log(2)*12;return Math.round(e)+69};d.Poly=function(t){t||(t={}),this.isSetUp=!1,this.playable=1,t.reverb?l(this,t):this.setUp(t)},d.Poly.prototype.setUp=function(t){if(this.wads=[],this.input=i.createAnalyser(),this.input.fftSize=2048,this.nodes=[this.input],this.destination=t.destination||i.destination,this.volume=t.volume||1,this.output=i.createGain(),this.output.gain.value=this.volume,this.tuna=t.tuna||null,"undefined"!=typeof Recorder&&t.recConfig){this.rec=new Recorder(this.output,t.recConfig),this.rec.recordings=[];var e=this,n=function(t){e.rec.createWadArg.source=t,e.rec.recordings.unshift(new d(e.rec.createWadArg))};this.rec.createWad=function(t){this.createWadArg=t||{env:{hold:9001}},this.getBuffer(n)}}this.globalReverb=t.globalReverb||!1,s(this,t),this.filter&&w(this,t),this.reverb&&x(this,t),this.constructExternalFx(t,i),h(this,t),_(this,t),t.compressor&&E(this,t),c(this,t),S(this,t),P(this,t),this.nodes.push(this.output),m(this,t),this.isSetUp=!0,t.callback&&t.callback(this)},d.Poly.prototype.updatePitch=function(e){this.input.getByteTimeDomainData(C);var n=t(C,i.sampleRate);if(-1!==n&&11025!==n&&12e3!==n){var r=n;this.pitch=Math.floor(r);var s=M(r);this.noteName=d.pitchesArray[s-12]}var o=this;o.rafID=window.requestAnimationFrame(function(){o.updatePitch()})},d.Poly.prototype.stopUpdatingPitch=function(){cancelAnimationFrame(this.rafID)},d.Poly.prototype.setVolume=function(t){return this.isSetUp?this.output.gain.value=t:console.log("This PolyWad is not set up yet."),this},d.Poly.prototype.play=function(t){if(this.isSetUp)if(this.playable<1)this.playOnLoad=!0,this.playOnLoadArg=t;else{t&&t.volume&&(this.output.gain.value=t.volume,t.volume=void 0);for(var e=0;e<this.wads.length;e++)this.wads[e].play(t)}else console.log("This PolyWad is not set up yet.");return this},d.Poly.prototype.stop=function(t){if(this.isSetUp)for(var e=0;e<this.wads.length;e++)this.wads[e].stop(t)},d.Poly.prototype.add=function(t){return this.isSetUp?(t.destination=this.input,this.wads.push(t),t instanceof d.Poly&&(t.output.disconnect(0),t.output.connect(this.input))):console.log("This PolyWad is not set up yet."),this},d.Poly.prototype.remove=function(t){if(this.isSetUp)for(var e=0;e<this.wads.length;e++)this.wads[e]===t&&(this.wads[e].destination=i.destination,this.wads.splice(e,1),t instanceof d.Poly&&(t.output.disconnect(0),t.output.connect(i.destination)));return this},d.Poly.prototype.constructExternalFx=function(t,e){},d.defaultImpulse="http://www.codecur.io/us/sendaudio/widehall.wav",d.setGlobalReverb=function(t){d.reverb={},d.reverb.node=i.createConvolver(),d.reverb.gain=i.createGain(),d.reverb.gain.gain.value=t.wet;var e=t.impulse||d.defaultImpulse,n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(n.response,function(t){d.reverb.node.buffer=t})},n.send()};var j=function(t,e){return null==t?e:t};d.pitches={A0:27.5,"A#0":29.1352,Bb0:29.1352,B0:30.8677,"B#0":32.7032,Cb1:30.8677,C1:32.7032,"C#1":34.6478,Db1:34.6478,D1:36.7081,"D#1":38.8909,Eb1:38.8909,E1:41.2034,Fb1:41.2034,"E#1":43.6535,F1:43.6535,"F#1":46.2493,Gb1:46.2493,G1:48.9994,"G#1":51.9131,Ab1:51.9131,A1:55,"A#1":58.2705,Bb1:58.2705,B1:61.7354,Cb2:61.7354,"B#1":65.4064,C2:65.4064,"C#2":69.2957,Db2:69.2957,D2:73.4162,"D#2":77.7817,Eb2:77.7817,E2:82.4069,Fb2:82.4069,"E#2":87.3071,F2:87.3071,"F#2":92.4986,Gb2:92.4986,G2:97.9989,"G#2":103.826,Ab2:103.826,A2:110,"A#2":116.541,Bb2:116.541,B2:123.471,Cb3:123.471,"B#2":130.813,C3:130.813,"C#3":138.591,Db3:138.591,D3:146.832,"D#3":155.563,Eb3:155.563,E3:164.814,Fb3:164.814,"E#3":174.614,F3:174.614,"F#3":184.997,Gb3:184.997,G3:195.998,"G#3":207.652,Ab3:207.652,A3:220,"A#3":233.082,Bb3:233.082,B3:246.942,Cb4:246.942,"B#3":261.626,C4:261.626,"C#4":277.183,Db4:277.183,D4:293.665,"D#4":311.127,Eb4:311.127,E4:329.628,Fb4:329.628,"E#4":349.228,F4:349.228,"F#4":369.994,Gb4:369.994,G4:391.995,"G#4":415.305,Ab4:415.305,A4:440,"A#4":466.164,Bb4:466.164,B4:493.883,Cb5:493.883,"B#4":523.251,C5:523.251,"C#5":554.365,Db5:554.365,D5:587.33,"D#5":622.254,Eb5:622.254,E5:659.255,Fb5:659.255,"E#5":698.456,F5:698.456,"F#5":739.989,Gb5:739.989,G5:783.991,"G#5":830.609,Ab5:830.609,A5:880,"A#5":932.328,Bb5:932.328,B5:987.767,Cb6:987.767,"B#5":1046.5,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,Fb6:1318.51,E6:1318.51,"E#6":1396.91,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,Cb7:1975.53,"B#6":2093,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,Fb7:2637.02,"E#7":2793.83,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,Cb8:3951.07,"B#7":4186.01,C8:4186.01},d.pitchesArray=["C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8"],d.midiInstrument={play:function(){console.log("playing midi")},stop:function(){console.log("stopping midi")}},d.midiInputs=[],midiMap=function(t){console.log(t.receivedTime,t.data),144===t.data[0]?0===t.data[2]?(console.log("|| stopping note: ",d.pitchesArray[t.data[1]-12]),d.midiInstrument.stop(d.pitchesArray[t.data[1]-12])):t.data[2]>0&&(console.log("> playing note: ",d.pitchesArray[t.data[1]-12]),d.midiInstrument.play({pitch:d.pitchesArray[t.data[1]-12],label:d.pitchesArray[t.data[1]-12],callback:function(t){}})):176===t.data[0]?(console.log("controller"),46==t.data[1]&&(127==t.data[2]?d.midiInstrument.pedalMod=!0:0==t.data[2]&&(d.midiInstrument.pedalMod=!1))):224===t.data[0]&&console.log("pitch bend")};var F=function(t){d.midiInputs=[];for(var e=t.inputs.values(),i=e.next();!i.done;i=e.next())d.midiInputs.push(i.value);console.log("MIDI inputs: ",d.midiInputs);for(var n=0;n<d.midiInputs.length;n++)d.midiInputs[n].onmidimessage=midiMap},A=function(t){console.log("uh-oh! Something went wrong!  Error code: "+t.code)};if(navigator&&navigator.requestMIDIAccess)try{navigator.requestMIDIAccess().then(F,A)}catch(t){var R="There was an error on this page.\n\n";R+="Error description: "+t.message+"\n\n",R+="Click OK to continue.\n\n",console.log(R)}return d.presets={hiHatClosed:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.03,release:.01},filter:{type:"highpass",frequency:400,q:1}},snare:{source:"noise",env:{attack:.001,decay:.01,sustain:.2,hold:.03,release:.02},filter:{type:"bandpass",frequency:300,q:.18}},hiHatOpen:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.43,release:.01},filter:{type:"highpass",frequency:100,q:.2}},ghost:{source:"square",volume:.3,env:{attack:.01,decay:.002,sustain:.5,hold:2.5,release:.3},filter:{type:"lowpass",frequency:600,q:7,env:{attack:.7,frequency:1600}},vibrato:{attack:8,speed:8,magnitude:100}},piano:{source:"square",volume:1.4,env:{attack:.01,decay:.005,sustain:.2,hold:.015,release:.3},filter:{type:"lowpass",frequency:1200,q:8.5,env:{attack:.2,frequency:600}}}},d}();return void 0!==t&&t.exports&&(t.exports=n),n})},/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},/*!***********************!*\
  !*** vertx (ignored) ***!
  \***********************/
function(t,e){},/*!***********************************!*\
  !*** multi ./js/athena-module.js ***!
  \***********************************/
function(t,e,i){t.exports=i(/*! ./js/athena-module.js */20)}])})},/*!**************************************!*\
  !*** ./js/objects/sample_objects.js ***!
  \**************************************/
function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.MyFont=e.MySprite=e.Smiley=void 0;var r=i(/*! ./smiley */8),s=n(r),o=i(/*! ./simple_bitmap_font */6),a=n(o),u=i(/*! ./simple_sprite */7),l=n(u);e.Smiley=s.default,e.MySprite=l.default,e.MyFont=a.default},/*!*********************!*\
  !*** ./js/index.js ***!
  \*********************/
function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(){var t=b[w];g.setScene(t.scene),(0,s.Dom)("#label").html(w+1+": "+t.label),++w>b.length-1&&(w=0)}var s=i(/*! athenajs */0),o=i(/*! ./scenes/scene1 */9),a=n(o),u=i(/*! ./scenes/scene2 */10),l=n(u),h=i(/*! ./scenes/scene3 */11),c=n(h),f=i(/*! ./scenes/scene4 */12),p=n(f),d=i(/*! ./scenes/scene5 */13),v=n(d),y=i(/*! ./scenes/scene6 */14),m=n(y),g=new s.Game({name:"athena-samples",showFps:!0,width:320,height:200,debug:!0}),b=[{label:"Base Objects",scene:a.default},{label:"Object Animations",scene:l.default},{label:"Behavior Example: press ⟸ / ⟹",scene:c.default},{label:"Scene Effects",scene:p.default},{label:"Sound Example: press ⟸ / ⟹",scene:v.default},{label:"Map Example: press ⟸ / ⟹",scene:m.default}],w=0;window.onload=function(){(0,s.Dom)("#nextScene")[0].addEventListener("click",r),r()}},/*!***********************!*\
  !*** ./js/map/map.js ***!
  \***********************/
function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={map:new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,125,126,127,125,126,127,12,0,0,0,0,0,0,0,0,0,0,0,0,0,10,125,126,127,12,0,0,0,39,154,155,156,154,155,156,41,0,0,0,0,0,0,0,0,0,0,0,0,0,39,154,155,156,41,0,0,0,68,183,184,185,183,184,185,70,10,125,126,127,125,126,127,125,126,127,12,0,0,68,183,184,185,70,0,0,0,97,212,213,214,212,213,214,99,39,154,155,156,154,155,156,154,155,156,41,0,0,97,212,213,214,99,0,0]),behaviors:new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}},/*!***************************!*\
  !*** ./js/map/sprites.js ***!
  \***************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.Bush=e.Tree=void 0;var o=i(/*! athenajs */0),a=function(t){function e(t){n(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"myBush",t));return i.addAnimation("static","tiles",{numFrames:1,frameWidth:73,frameHeight:32,frameDuration:1,offsetX:177,offsetY:128}),i.addAnimation("static2","tiles",{numFrames:1,frameWidth:73,frameHeight:32,frameDuration:1,offsetX:177,offsetY:160}),i}return s(e,t),e}(o.Sprite),u=function(t){function e(t){n(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"myTree",t));return i.addAnimation("static","tiles",{numFrames:1,frameWidth:51,frameHeight:116,frameDuration:1,offsetX:22,offsetY:43}),i.addAnimation("static2","tiles",{numFrames:1,frameWidth:51,frameHeight:116,frameDuration:1,offsetX:118,offsetY:43}),i}return s(e,t),e}(o.Sprite);e.Tree=u,e.Bush=a},/*!***************************************!*\
  !*** ./js/objects/bounce_behavior.js ***!
  \***************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.vx=0,s.vy=0,s.gravity=.1,s}return s(e,t),o(e,[{key:"onUpdate",value:function(t){var e=this.sprite;e.y+=this.vy,this.vy+=this.gravity,e.y>=200-e.height&&(this.onVYChange&&this.onVYChange(e.vx),e.y=200-e.height,this.vy*=-.95),a.InputManager.isKeyDown("RIGHT")&&e.x<320-e.width?e.x+=2:a.InputManager.isKeyDown("LEFT")&&e.x>1&&(e.x-=2)}}]),e}(a.Behavior);e.default=u},/*!******************************************!*\
  !*** ./js/objects/simple_bitmap_font.js ***!
  \******************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(/*! athenajs */0),a=function(t){function e(t){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"myFont",Object.assign({width:320,height:64,charWidth:32,charHeight:32,imageSrc:"img/bitmapFont.png",offsetX:34,startY:2},t)))}return s(e,t),e}(o.BitmapText);e.default=a},/*!*************************************!*\
  !*** ./js/objects/simple_sprite.js ***!
  \*************************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(/*! athenajs */0),a=function(t){function e(t){n(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"mySprite",t));return i.addAnimation("run","sballer",{numFrames:9,frameWidth:82,frameHeight:69,frameDuration:4}),i}return s(e,t),e}(o.Sprite);e.default=a},/*!******************************!*\
  !*** ./js/objects/smiley.js ***!
  \******************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=function(t){function e(t){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a.Paint.name,t))}return s(e,t),o(e,[{key:"render",value:function(){this.circle(0,0,this.width/2,"yellow",2,"black"),this.circle(this.width/5,this.height/3,this.width/12,"black"),this.circle(this.width-this.width/3,this.height/3,this.width/12,"black"),this.arc(this.width/2,this.height-this.height/2.5,this.width/4,0,Math.PI,"black",2)}}]),e}(a.Paint);e.default=u},/*!*****************************!*\
  !*** ./js/scenes/scene1.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=i(/*! ../objects/sample_objects */1),l=new(function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"setup",value:function(){this.loadImage("img/bitmapFont.png","myFont"),this.loadImage("img/sprites.png","mySheet"),this.loadImage("img/sballer_sprites.png","sballer")}},{key:"start",value:function(){this.addObject(new u.MyFont({text:"AthenaJS\nRulez"})),this.addObject(new u.Smiley({width:40,height:40,y:100,x:10})),this.addObject(new u.MySprite({x:50,y:100})),this.addObject(new a.SimpleText("nextString",{text:"Canvas text",x:150,y:120,color:"black"}))}}]),e}(a.Scene));e.default=l},/*!*****************************!*\
  !*** ./js/scenes/scene2.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=i(/*! ../objects/sample_objects */1),l=new(function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"setup",value:function(){this.loadImage("img/bitmapFont.png","myFont"),this.loadImage("img/sprites.png","mySheet"),this.loadImage("img/sballer_sprites.png","sballer")}},{key:"start",value:function(){var t=new u.MyFont({text:"AthenaJS\nRulez",x:0,y:80}),e=new u.Smiley({width:40,height:40,y:100,x:10}),i=new a.SimpleText("nextString",{text:"Canvas text",x:150,y:120,color:"black"}),n=new u.MySprite({x:0,y:0});this.addObject([t,i,e,n]),e.animate("Fade",{startValue:0,endValue:1,loop:1/0,duration:1e3}),t.animate("Rotate",{startValue:0,endValue:2*Math.PI,loop:1/0,duration:4e3}),n.animate("Custom",{startValue:0,endValue:2,duration:1e3,loop:1/0,callback:function(t){n.setScale(t)}}),i.animate("Rotate",{startValue:0,endValue:2*Math.PI,loop:1/0,duration:8e3})}}]),e}(a.Scene));e.default=l},/*!*****************************!*\
  !*** ./js/scenes/scene3.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=i(/*! ../objects/sample_objects */1),l=i(/*! ../objects/bounce_behavior */5),h=function(t){return t&&t.__esModule?t:{default:t}}(l),c=new(function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"start",value:function(){this.addObject(new u.Smiley({width:40,height:40,y:100,x:10,behavior:h.default}))}}]),e}(a.Scene));e.default=c},/*!*****************************!*\
  !*** ./js/scenes/scene4.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},u=i(/*! athenajs */0),l=i(/*! ../objects/sample_objects */1),h=function(t){function e(t,i){n(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({startValue:Math.PI/3,endValue:0,when:"post"},t),i));return s.buffer=i.getBuffer(s.width,s.height),s}return s(e,t),o(e,[{key:"process",value:function(t,i){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"process",this).call(this);var n=this.startValue-this.animProgress*this.startValue;return this.buffer.drawImage(t.canvas,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.setTransform(1,Math.tan(n),0,1,0,0),t.drawImage(this.buffer.canvas,0,0),this.ended}}]),e}(u.Effect);u.FX.addFX("Skew",h);var c=new(function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"setup",value:function(){this.loadImage("img/bitmapFont.png","myFont")}},{key:"start",value:function(){var t=this;this.addObject(new l.MyFont({text:"AthenaJS\nRulez",x:0,y:100})),this.addObject(new u.SimpleText("nextString",{text:"Press keys:\n1 ⟶ fade\n2 ⟶ skew\n3 ⟶ mosaic",x:100,y:0,color:"black"})),u.InputManager.installKeyCallback("1 2 3","up",function(e,i){t.applyEffect(parseInt(e,10))}),this.effectInProcess=!1}},{key:"applyEffect",value:function(t){var e=this,i=void 0;if(!this.effectInProcess){switch(this.effectInProcess=!0,t){case 1:i=this.fadeIn(2e3);break;case 2:i=this.animate("Skew",{when:"post",startValue:Math.PI/3,endValue:0,duration:2e3,easing:"easeOutBounce"});break;case 3:i=this.animate("Mosaic",{when:"post",duration:1e3,startValue:5e-5,endValue:.2,easing:"linear"})}i.then(function(){e.effectInProcess=!1})}}}]),e}(u.Scene));e.default=c},/*!*****************************!*\
  !*** ./js/scenes/scene5.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=(i(/*! ../objects/sample_objects */1),new(function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"setup",value:function(){this.loadAudio("sound/throw_knife.mp3","throw")}},{key:"start",value:function(){this.addObject(new a.SimpleText("nextString",{text:"Press keys:\n ⟶ throw left\n ⟶ throw right\ncenter",x:100,y:0,color:"black"})),a.InputManager.installKeyCallback("LEFT","up",function(t,e){a.AudioManager.play("throw",!1,10,-10)}),a.InputManager.installKeyCallback("RIGHT","up",function(t,e){a.AudioManager.play("throw",!1,10,10)})}}]),e}(a.Scene)));e.default=u},/*!*****************************!*\
  !*** ./js/scenes/scene6.js ***!
  \*****************************/
function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(/*! athenajs */0),u=i(/*! ../map/map.js */3),l=function(t){return t&&t.__esModule?t:{default:t}}(u),h=i(/*! ../map/sprites */4),c=new(function(t){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"setup",value:function(){this.loadImage("img/tileset.png","tiles")}},{key:"createMap",value:function(){for(var t=new a.Map({src:"tiles",tileWidth:32,tileHeight:32,width:928,height:256,viewportW:320,viewportH:200}),e=[],i=0;i<8;i++)for(var n=0;n<29;n++)e.push({offsetX:32*n,offsetY:32*i,width:32,height:32});t.addTileSet(e),t.setData(l.default.map,l.default.behaviors),this.setMap(t)}},{key:"start",value:function(){var t=this;this.createMap(),this.setLayerPriority(0,!0),this.map.addObject(new h.Bush({x:80,y:126})),this.map.addObject(new h.Tree({x:170,y:40})),this.map.addObject(new h.Bush({x:320,y:190})),this.map.addObject(new h.Tree({x:400,y:104})),this.map.addObject(new h.Bush({x:490,y:190})),this.map.addObject(new h.Bush({x:730,y:126})),this.map.addObject(new h.Tree({x:800,y:40})),this.map.addObject(new h.Bush({x:780,y:126})),this.addObject(new a.SimpleText("string",{text:"Multidirectional scrolling with easing :)",x:5,y:5,color:"black"})),this.map.duration=2e3,this.map.setEasing("easeOutBounce"),a.InputManager.installKeyCallback("RIGHT","up",function(e,i){t.map.moveTo(-1e3,-1e3)}),a.InputManager.installKeyCallback("LEFT","up",function(e,i){t.map.moveTo(0,0)})}}]),e}(a.Scene));e.default=c},/*!***************************!*\
  !*** multi ./js/index.js ***!
  \***************************/
function(t,e,i){t.exports=i(/*! ./js/index.js */2)}]);